<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Serguei Ossokine">

<title>The elephant of surprise - Veni, vidi, bibi</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
<link rel="stylesheet" href="style.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">The elephant of surprise</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page">
      <div class="quarto-title-block"><div><h1 class="title">Veni, vidi, bibi</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Serguei Ossokine </p>
            </div>
    </div>
      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block column-page" id="quarto-document-content">




<section id="introduction" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1.1</span> Introduction</h2>
<p>Wine is one of the most widely enjoyed alcoholic beverages in the world. It carries a rich cultural heritage and a fascinating history that dates back thousands of years. Recent studies have shown that grapes were actually domesticated <em>twice</em> almost concurrently in western Asia and the Caucasus almost 11000 years ago<span class="citation" data-cites="DongYang2023Ddao">(<a href="#ref-DongYang2023Ddao" role="doc-biblioref">Dong et al. 2023</a>)</span>. Early farmers that migrated from western Asia towards the Iberian peninisula brough with them the domesticated grapevines. These vines were in turn cross-bred with local varieties which created muscat grapes which were high in sugar. These were the earliest progenitors of the different grape varieties that are found today in many European wine-making regions. Grapes for wine making continued to be cultivated througout Europe and then spread across the globe. Today wine-making is a large industry, worth billions of euros in exports per year.</p>
<p>But it is notably dependent on the climate. Knowing how it will grow under expected, familiar conditions gives it the consistency necessary for industry. How and where has wine been made - and which kinds of wine - across Europe? How much can we expect in trade per year? And what will happen in future years, with the threat of climate change?</p>
<p>In this series of blogposts, we will look at many different aspects of wine production in Europe using the latest public datasets. In particular, we will follow the following roadmap (click to get more details):</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Part I: Vineyards and wine production
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In this part, we will explore where in Europe wine production takes place, as well as the volume of wine produced by different countries. We will also look into historical trends in wine production.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Part II: Wine export and consumption
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In this part, we will look into the details of wine trade as well as trends in wine consumption.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Part III: Climate and wine
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In this part, we will take a deep dive into what climactic factors affect wine and will examine their effects on historical data.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Part IV: Climate change and the future
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We will conclude by taking a look what different state-of-the-art climate models predict for the coming decades and what implications this has for wine making.</p>
</div>
</div>
</div>
</section>
<section id="setting-up-the-analysis-environment" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="setting-up-the-analysis-environment"><span class="header-section-number">1.2</span> Setting up the analysis environment</h2>
<p>To perform this analysis, we will use <code>Python</code> and many of the standard data science packages written for it. In particular we will rely heavily on <a href="https://pandas.pydata.org/">pandas</a> and <a href="https://matplotlib.org/">matplotlib</a>. If you have not encountered these before it is highly recommended to get familiar with them first.</p>
<p>In order to ensure a reproducible analysis, we encourage people to use an isolated <code>Python</code> environment (a virtual environment). While there are many different ways of doing this, we recommend using <code>conda/mamba</code> since it also allows for convenient management of <code>C</code> dependencies. A detailed description of how to set up the environment can be found in <a href="#sec-env">Section&nbsp;2.1</a>.</p>
<p>Let’s load all the packages we need and set up some defaults (the <code>matplotlib</code> style file and additional analysis functions are <a href="https://github.com/SergeiOssokine/SergeiOssokine.github.io/tree/main/analysis">here</a>):</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cartopy.crs <span class="im">as</span> ccrs</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cartopy.feature <span class="im">as</span> cf</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cartopy</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rich <span class="im">import</span> <span class="bu">print</span> <span class="im">as</span> pprint</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>DATADIR <span class="op">=</span> <span class="st">"../../../wine_analysis/data/"</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Use out custom matplotlib style</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">"../../analysis/setup/wine_analysis.mplstyle"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Use some matplotlib helpers</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">"../../analysis/scripts/"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib_extensions <span class="im">import</span> <span class="op">*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="wine-production-in-europe" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="wine-production-in-europe"><span class="header-section-number">1.3</span> Wine production in Europe</h2>
<section id="where-is-it" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="where-is-it"><span class="header-section-number">1.3.1</span> Where is it?</h3>
<p>The EU is the largest producer and exporter of wine in the world. Making and consuming wine is a long-held tradition in many European countries. Traditionally, this production has been mostly limited to southern parts of the EU where the conditions are optimal for growing different types of wine. Wine needs warm weather, lots of sun, and a fair amount of rain.</p>
<p>Our first goal is to map the modern location of European vineyards. To do this, we will of course need an extensive dataset of vineyard locations. While it’s possible to attempt to build such a dataset from scratch - starting for example from registration data for wineries in the EU - satellite land usage maps already provide a very complete data set. These surveys divide the surface of the Earth into a grid and classify the satellite data within each cell into different classes based on what the land is used for.</p>
<p>The <a href="https://land.copernicus.eu/pan-european/corine-land-cover">Corine Land Cover (CLC) inventory</a> is the largest database of land cover and land use available for Europe. The first release was 1990 and since then it has been updated several times: 2000, 2006, 2012, and the latest release in 2018. What makes the CLC particularly useful for us is that it explicitly separates vineyards from other types of agricultural use. CLC data is and available freely for research use. We’ll use the CLC 2018 dataset to create a map of wine production in Europe.</p>
<p>The data is available in three different formats: raster (<a href="https://www.loc.gov/preservation/digital/formats/fdd/fdd000279.shtml">GEOTiff</a>), SQLite or <a href="https://docs.fileformat.com/database/gdb/">ESRI database</a>. For simplicity we use the GEOTiff raster format, which represents the data as values on a regularly-spaced grid. It comes with extensive documentation, including how to load and examine the data using the <a href="https://qgis.org/en/site/">QGIS</a> open-source application. See <a href="#sec-corine">Section&nbsp;2.2.1</a> for details on obtaining the data.</p>
<p>Before diving into the details, it is worth taking a quick look at the data inside the file. This can be done with <code>gdalinfo</code>, a command-line utility that comes as part of the <a href="https://gdal.org/index.html">GDAL library</a> (it was installed as one of the dependencies in the <code>mamba</code> environment above). Executing the following:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gdalinfo</span> <span class="va">${DATADIR}</span>/wine_statistics/u2018_clc2018_v2020_20u1_raster100m/DATA/u2018_clc2018_v2020_20u1_raster100m.tif <span class="kw">|</span> <span class="fu">nl</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>yields (we suppress some output for clarity but the line numbers correspond to what one would see)</p>
<div class="sourceCode" id="annotated-cell-3"><pre class="sourceCode bash code-annotation-code code-with-copy code-annotated"><code class="sourceCode bash"><span id="annotated-cell-3-1"><a href="#annotated-cell-3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Driver: GTiff/GeoTIFF</span>
<span id="annotated-cell-3-2"><a href="#annotated-cell-3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>   Files: ../../../data/wine_statistics/u2018_clc2018_v2020_20u1_raster100m/DATA/U2018_CLC2018_V2020_20u1.tif</span>
<span id="annotated-cell-3-3"><a href="#annotated-cell-3-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>         ../../../data/wine_statistics/u2018_clc2018_v2020_20u1_raster100m/DATA/U2018_CLC2018_V2020_20u1.tif.ovr</span>
<span id="annotated-cell-3-4"><a href="#annotated-cell-3-4" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         ../../../data/wine_statistics/u2018_clc2018_v2020_20u1_raster100m/DATA/U2018_CLC2018_V2020_20u1.tif.aux.xml</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-3-5" class="code-annotation-target"><a href="#annotated-cell-3-5" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>   Size is 65000, 46000</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-3-6" class="code-annotation-target"><a href="#annotated-cell-3-6" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>   Coordinate System is:</span>
<span id="annotated-cell-3-7"><a href="#annotated-cell-3-7" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>   PROJCRS[<span class="st">"ETRS89-extended / LAEA Europe"</span>,</span>
<span id="annotated-cell-3-8"><a href="#annotated-cell-3-8" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>      BASEGEOGCRS[<span class="st">"ETRS89"</span>,</span>
<span id="annotated-cell-3-9"><a href="#annotated-cell-3-9" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>          DATUM[<span class="st">"European Terrestrial Reference System 1989"</span>,</span>
<span id="annotated-cell-3-10"><a href="#annotated-cell-3-10" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>             ELLIPSOID[<span class="st">"GRS 1980"</span>,6378137,298.257222101004,</span>
<span id="annotated-cell-3-11"><a href="#annotated-cell-3-11" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>                 LENGTHUNIT<span class="pp">[</span><span class="st">"metre"</span><span class="ss">,1</span><span class="pp">]</span>]],</span>
<span id="annotated-cell-3-12"><a href="#annotated-cell-3-12" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>         PRIMEM[<span class="st">"Greenwich"</span>,0,</span>
<span id="annotated-cell-3-13"><a href="#annotated-cell-3-13" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>             ANGLEUNIT<span class="pp">[</span><span class="st">"degree"</span><span class="ss">,0.0174532925199433</span><span class="pp">]</span>],</span>
<span id="annotated-cell-3-14"><a href="#annotated-cell-3-14" aria-hidden="true" tabindex="-1"></a><span class="ex">14</span>         ID<span class="pp">[</span><span class="st">"EPSG"</span><span class="ss">,4258</span><span class="pp">]</span>],</span>
<span id="annotated-cell-3-15"><a href="#annotated-cell-3-15" aria-hidden="true" tabindex="-1"></a><span class="ex">15</span>     CONVERSION[<span class="st">"Lambert Azimuthal Equal Area"</span>,</span>
<span id="annotated-cell-3-16"><a href="#annotated-cell-3-16" aria-hidden="true" tabindex="-1"></a><span class="ex">16</span>         METHOD[<span class="st">"Lambert Azimuthal Equal Area"</span>,</span>
<span id="annotated-cell-3-17"><a href="#annotated-cell-3-17" aria-hidden="true" tabindex="-1"></a><span class="ex">17</span>             ID<span class="pp">[</span><span class="st">"EPSG"</span><span class="ss">,9820</span><span class="pp">]</span>],</span>
<span id="annotated-cell-3-18"><a href="#annotated-cell-3-18" aria-hidden="true" tabindex="-1"></a><span class="ex">18</span>         PARAMETER[<span class="st">"Latitude of natural origin"</span>,52,</span>
<span id="annotated-cell-3-19"><a href="#annotated-cell-3-19" aria-hidden="true" tabindex="-1"></a><span class="ex">19</span>             ANGLEUNIT<span class="pp">[</span><span class="st">"degree"</span><span class="ss">,0.0174532925199433</span><span class="pp">]</span>,</span>
<span id="annotated-cell-3-20"><a href="#annotated-cell-3-20" aria-hidden="true" tabindex="-1"></a><span class="ex">20</span>             ID<span class="pp">[</span><span class="st">"EPSG"</span><span class="ss">,8801</span><span class="pp">]</span>],</span>
<span id="annotated-cell-3-21"><a href="#annotated-cell-3-21" aria-hidden="true" tabindex="-1"></a><span class="ex">21</span>         PARAMETER[<span class="st">"Longitude of natural origin"</span>,10,</span>
<span id="annotated-cell-3-22"><a href="#annotated-cell-3-22" aria-hidden="true" tabindex="-1"></a><span class="ex">22</span>             ANGLEUNIT<span class="pp">[</span><span class="st">"degree"</span><span class="ss">,0.0174532925199433</span><span class="pp">]</span>,</span>
<span id="annotated-cell-3-23"><a href="#annotated-cell-3-23" aria-hidden="true" tabindex="-1"></a><span class="ex">23</span>             ID<span class="pp">[</span><span class="st">"EPSG"</span><span class="ss">,8802</span><span class="pp">]</span>],</span>
<span id="annotated-cell-3-24"><a href="#annotated-cell-3-24" aria-hidden="true" tabindex="-1"></a><span class="ex">24</span>         PARAMETER[<span class="st">"False easting"</span>,4321000,</span>
<span id="annotated-cell-3-25"><a href="#annotated-cell-3-25" aria-hidden="true" tabindex="-1"></a><span class="ex">25</span>             LENGTHUNIT<span class="pp">[</span><span class="st">"metre"</span><span class="ss">,1</span><span class="pp">]</span>,</span>
<span id="annotated-cell-3-26"><a href="#annotated-cell-3-26" aria-hidden="true" tabindex="-1"></a><span class="ex">26</span>             ID<span class="pp">[</span><span class="st">"EPSG"</span><span class="ss">,8806</span><span class="pp">]</span>],</span>
<span id="annotated-cell-3-27"><a href="#annotated-cell-3-27" aria-hidden="true" tabindex="-1"></a><span class="ex">27</span>         PARAMETER[<span class="st">"False northing"</span>,3210000,</span>
<span id="annotated-cell-3-28"><a href="#annotated-cell-3-28" aria-hidden="true" tabindex="-1"></a><span class="ex">28</span>             LENGTHUNIT<span class="pp">[</span><span class="st">"metre"</span><span class="ss">,1</span><span class="pp">]</span>,</span>
<span id="annotated-cell-3-29"><a href="#annotated-cell-3-29" aria-hidden="true" tabindex="-1"></a><span class="ex">29</span>             ID<span class="pp">[</span><span class="st">"EPSG"</span><span class="ss">,8807</span><span class="pp">]</span>]],</span>
<span id="annotated-cell-3-30"><a href="#annotated-cell-3-30" aria-hidden="true" tabindex="-1"></a><span class="ex">30</span>     CS<span class="pp">[</span><span class="ss">Cartesian,2</span><span class="pp">]</span>,</span>
<span id="annotated-cell-3-31"><a href="#annotated-cell-3-31" aria-hidden="true" tabindex="-1"></a><span class="ex">31</span>         AXIS[<span class="st">"(E)"</span>,east,</span>
<span id="annotated-cell-3-32"><a href="#annotated-cell-3-32" aria-hidden="true" tabindex="-1"></a><span class="ex">32</span>             ORDER<span class="pp">[</span><span class="ss">1</span><span class="pp">]</span>,</span>
<span id="annotated-cell-3-33"><a href="#annotated-cell-3-33" aria-hidden="true" tabindex="-1"></a><span class="ex">33</span>             LENGTHUNIT<span class="pp">[</span><span class="st">"metre"</span><span class="ss">,1</span><span class="pp">]</span>],</span>
<span id="annotated-cell-3-34"><a href="#annotated-cell-3-34" aria-hidden="true" tabindex="-1"></a><span class="ex">34</span>         AXIS[<span class="st">"(N)"</span>,north,</span>
<span id="annotated-cell-3-35"><a href="#annotated-cell-3-35" aria-hidden="true" tabindex="-1"></a><span class="ex">35</span>             ORDER<span class="pp">[</span><span class="ss">2</span><span class="pp">]</span>,</span>
<span id="annotated-cell-3-36"><a href="#annotated-cell-3-36" aria-hidden="true" tabindex="-1"></a><span class="ex">36</span>             LENGTHUNIT<span class="pp">[</span><span class="st">"metre"</span><span class="ss">,1</span><span class="pp">]</span>],</span>
<span id="annotated-cell-3-37"><a href="#annotated-cell-3-37" aria-hidden="true" tabindex="-1"></a><span class="ex">37</span>     ID<span class="pp">[</span><span class="st">"EPSG"</span><span class="ss">,3035</span><span class="pp">]</span>]</span>
<span id="annotated-cell-3-38"><a href="#annotated-cell-3-38" aria-hidden="true" tabindex="-1"></a><span class="ex">[--------------------------------SNIP-----------------------------------------------------]</span></span>
<span id="annotated-cell-3-39"><a href="#annotated-cell-3-39" aria-hidden="true" tabindex="-1"></a><span class="ex">47</span>  Corner Coordinates:</span>
<span id="annotated-cell-3-40"><a href="#annotated-cell-3-40" aria-hidden="true" tabindex="-1"></a><span class="ex">48</span>  Upper Left  <span class="er">(</span>  <span class="ex">900000.000,</span> 5500000.000<span class="kw">)</span> <span class="kw">(</span> <span class="ex">56d30</span><span class="st">'18.51"W, 56d29'</span> 4.75<span class="st">"N)</span></span>
<span id="annotated-cell-3-41"><a href="#annotated-cell-3-41" aria-hidden="true" tabindex="-1"></a><span class="st">[--------------------------------SNIP-----------------------------------------------------]</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-3-42" class="code-annotation-target"><a href="#annotated-cell-3-42" aria-hidden="true" tabindex="-1"></a><span class="st">53  Band 1 Block=128x128 Type=Int8, ColorInterp=Gray</span></span>
<span id="annotated-cell-3-43"><a href="#annotated-cell-3-43" aria-hidden="true" tabindex="-1"></a><span class="st">54   Min=1.000 Max=48.000</span></span>
<span id="annotated-cell-3-44"><a href="#annotated-cell-3-44" aria-hidden="true" tabindex="-1"></a><span class="st">55   Minimum=1.000, Maximum=48.000, Mean=25.753, StdDev=11.680</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-3-45" class="code-annotation-target"><a href="#annotated-cell-3-45" aria-hidden="true" tabindex="-1"></a><span class="st">56   NoData Value=-128</span></span>
<span id="annotated-cell-3-46"><a href="#annotated-cell-3-46" aria-hidden="true" tabindex="-1"></a><span class="st">[--------------------------------SNIP-----------------------------------------------------]</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-annotation="1" data-code-lines="5">Line 5 : the data is on a <span class="math inline">\(65000\times46000\)</span> grid, corresponding to a spatial resolution of 100 meters.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-annotation="2" data-code-lines="6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37">Lines 6-35: detailed description of the coordinate system used to represent the spatial data, given in <a href="https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry">Well-known text (WKT)</a> format. See <a href="">this post</a> for more information on coordinate systems frequently used in GIS.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-annotation="3" data-code-lines="42,43">Lines 53-54: the land use classes are encoded as integers of type <code>Int8</code> with values ranging from 1 to 48. We will need to figure out what number corresponds to vineyards.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-annotation="4" data-code-lines="45">Line 56: missing values are indicated by -128.</span>
</dd>
</dl>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>One should be careful when loading this data into any tool that treats all numerical values as <code>float64</code> types, because while a <span class="math inline">\(65000\times46000\)</span> array of <code>Int8</code> occupies ~3 GB, the same array of <code>float64</code> type would occupy 8 times more: ~24 GB.</p>
</div>
</div>
</div>
<p><code>xarray</code> package provides a great way of interacting with this sort of data via <code>xarray.DataArray</code> which is a multi-dimensional labelled datatype. One can think of it either as a generalization of a multi-dimensional numpy array where more data about the dimensions is stored. There is also a package <code>rioxarray</code> which can load raster file types like <code>GEOTiff</code> directly into <code>xarray</code> objects:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>dset <span class="op">=</span> rioxarray.open_rasterio(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"</span><span class="sc">{</span>DATADIR<span class="sc">}</span><span class="ss">/wine_statistics/u2018_clc2018_v2020_20u1_raster100m/DATA/U2018_CLC2018_V2020_20u1.tif"</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>dset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">

<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewbox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewbox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class="xr-text-repr-fallback">&lt;xarray.DataArray (band: 1, y: 46000, x: 65000)&gt;
[2990000000 values with dtype=int8]
Coordinates:
  * band         (band) int64 1
  * x            (x) float64 9e+05 9.002e+05 9.002e+05 ... 7.4e+06 7.4e+06
  * y            (y) float64 5.5e+06 5.5e+06 5.5e+06 ... 9.002e+05 9e+05
    spatial_ref  int64 0
Attributes: (12/13)
    AREA_OR_POINT:           Area
    DataType:                Thematic
    RepresentationType:      THEMATIC
    STATISTICS_COVARIANCES:  136.429646247598
    STATISTICS_MAXIMUM:      48
    STATISTICS_MEAN:         25.753373398066
    ...                      ...
    STATISTICS_SKIPFACTORX:  1
    STATISTICS_SKIPFACTORY:  1
    STATISTICS_STDDEV:       11.680310194836
    _FillValue:              -128
    scale_factor:            1.0
    add_offset:              0.0</pre><div class="xr-wrap" style="display:none"><div class="xr-header"><div class="xr-obj-type">xarray.DataArray</div><div class="xr-array-name"></div><ul class="xr-dim-list"><li><span class="xr-has-index">band</span>: 1</li><li><span class="xr-has-index">y</span>: 46000</li><li><span class="xr-has-index">x</span>: 65000</li></ul></div><ul class="xr-sections"><li class="xr-section-item"><div class="xr-array-wrap"><input id="section-17ec42dc-9b37-4055-955e-b56d66df1110" class="xr-array-in" type="checkbox" checked=""><label for="section-17ec42dc-9b37-4055-955e-b56d66df1110" title="Show/hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-array-preview xr-preview"><span>...</span></div><div class="xr-array-data"><pre>[2990000000 values with dtype=int8]</pre></div></div></li><li class="xr-section-item"><input id="section-483eb91a-6360-4fc8-9ad0-57594c74ad84" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-483eb91a-6360-4fc8-9ad0-57594c74ad84" class="xr-section-summary">Coordinates: <span>(4)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">band</span></div><div class="xr-var-dims">(band)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">1</div><input id="attrs-cd7d1d7b-f5ad-48d0-a9d6-f8aacb8f082b" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-cd7d1d7b-f5ad-48d0-a9d6-f8aacb8f082b" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-28cfa824-7e20-40b1-a1d8-f91dc9a26371" class="xr-var-data-in" type="checkbox"><label for="data-28cfa824-7e20-40b1-a1d8-f91dc9a26371" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([1])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">x</span></div><div class="xr-var-dims">(x)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">9e+05 9.002e+05 ... 7.4e+06 7.4e+06</div><input id="attrs-a65bb832-1c62-4ce8-a03f-8f9548a6363a" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-a65bb832-1c62-4ce8-a03f-8f9548a6363a" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-35a06489-6d42-4b32-b63c-8fb9c014774b" class="xr-var-data-in" type="checkbox"><label for="data-35a06489-6d42-4b32-b63c-8fb9c014774b" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([ 900050.,  900150.,  900250., ..., 7399750., 7399850., 7399950.])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">y</span></div><div class="xr-var-dims">(y)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">5.5e+06 5.5e+06 ... 9.002e+05 9e+05</div><input id="attrs-9101b8bc-ea4d-44a0-b6b9-e7136d71ecc0" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-9101b8bc-ea4d-44a0-b6b9-e7136d71ecc0" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-16d30514-13a2-4fc5-a9c8-7158d7956123" class="xr-var-data-in" type="checkbox"><label for="data-16d30514-13a2-4fc5-a9c8-7158d7956123" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([5499950., 5499850., 5499750., ...,  900250.,  900150.,  900050.])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>spatial_ref</span></div><div class="xr-var-dims">()</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">0</div><input id="attrs-04cbfec5-1970-4c34-ba27-2e6981fba3a4" class="xr-var-attrs-in" type="checkbox"><label for="attrs-04cbfec5-1970-4c34-ba27-2e6981fba3a4" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-4307c86d-bf15-4755-b3d5-05d91d0e07fc" class="xr-var-data-in" type="checkbox"><label for="data-4307c86d-bf15-4755-b3d5-05d91d0e07fc" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>crs_wkt :</span></dt><dd>PROJCS["ETRS89-extended / LAEA Europe",GEOGCS["ETRS89",DATUM["European_Terrestrial_Reference_System_1989",SPHEROID["GRS 1980",6378137,298.257222101004,AUTHORITY["EPSG","7019"]],AUTHORITY["EPSG","6258"]],PRIMEM["Greenwich",0],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4258"]],PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["latitude_of_center",52],PARAMETER["longitude_of_center",10],PARAMETER["false_easting",4321000],PARAMETER["false_northing",3210000],UNIT["metre",1],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","3035"]]</dd><dt><span>semi_major_axis :</span></dt><dd>6378137.0</dd><dt><span>semi_minor_axis :</span></dt><dd>6356752.314140356</dd><dt><span>inverse_flattening :</span></dt><dd>298.257222101004</dd><dt><span>reference_ellipsoid_name :</span></dt><dd>GRS 1980</dd><dt><span>longitude_of_prime_meridian :</span></dt><dd>0.0</dd><dt><span>prime_meridian_name :</span></dt><dd>Greenwich</dd><dt><span>geographic_crs_name :</span></dt><dd>ETRS89</dd><dt><span>horizontal_datum_name :</span></dt><dd>European Terrestrial Reference System 1989</dd><dt><span>projected_crs_name :</span></dt><dd>ETRS89-extended / LAEA Europe</dd><dt><span>grid_mapping_name :</span></dt><dd>lambert_azimuthal_equal_area</dd><dt><span>latitude_of_projection_origin :</span></dt><dd>52.0</dd><dt><span>longitude_of_projection_origin :</span></dt><dd>10.0</dd><dt><span>false_easting :</span></dt><dd>4321000.0</dd><dt><span>false_northing :</span></dt><dd>3210000.0</dd><dt><span>spatial_ref :</span></dt><dd>PROJCS["ETRS89-extended / LAEA Europe",GEOGCS["ETRS89",DATUM["European_Terrestrial_Reference_System_1989",SPHEROID["GRS 1980",6378137,298.257222101004,AUTHORITY["EPSG","7019"]],AUTHORITY["EPSG","6258"]],PRIMEM["Greenwich",0],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4258"]],PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["latitude_of_center",52],PARAMETER["longitude_of_center",10],PARAMETER["false_easting",4321000],PARAMETER["false_northing",3210000],UNIT["metre",1],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","3035"]]</dd><dt><span>GeoTransform :</span></dt><dd>900000.0 100.0 0.0 5500000.0 0.0 -100.0</dd></dl></div><div class="xr-var-data"><pre>array(0)</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-33e0d701-a196-4a08-81cb-aff7fac6e547" class="xr-section-summary-in" type="checkbox"><label for="section-33e0d701-a196-4a08-81cb-aff7fac6e547" class="xr-section-summary">Indexes: <span>(3)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-index-name"><div>band</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-04f9bb93-cd80-4cd4-ae4a-37118edcf704" class="xr-index-data-in" type="checkbox"><label for="index-04f9bb93-cd80-4cd4-ae4a-37118edcf704" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([1], dtype='int64', name='band'))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>x</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-94fa7cd4-b40d-4d36-a59f-be1b7528500d" class="xr-index-data-in" type="checkbox"><label for="index-94fa7cd4-b40d-4d36-a59f-be1b7528500d" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([ 900050.0,  900150.0,  900250.0,  900350.0,  900450.0,  900550.0,
        900650.0,  900750.0,  900850.0,  900950.0,
       ...
       7399050.0, 7399150.0, 7399250.0, 7399350.0, 7399450.0, 7399550.0,
       7399650.0, 7399750.0, 7399850.0, 7399950.0],
      dtype='float64', name='x', length=65000))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>y</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-e61a08c2-c217-4c95-9a70-bd3c323126d5" class="xr-index-data-in" type="checkbox"><label for="index-e61a08c2-c217-4c95-9a70-bd3c323126d5" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([5499950.0, 5499850.0, 5499750.0, 5499650.0, 5499550.0, 5499450.0,
       5499350.0, 5499250.0, 5499150.0, 5499050.0,
       ...
        900950.0,  900850.0,  900750.0,  900650.0,  900550.0,  900450.0,
        900350.0,  900250.0,  900150.0,  900050.0],
      dtype='float64', name='y', length=46000))</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-4c90cbc0-2978-46ba-90e6-2f1f905afad9" class="xr-section-summary-in" type="checkbox"><label for="section-4c90cbc0-2978-46ba-90e6-2f1f905afad9" class="xr-section-summary">Attributes: <span>(13)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><dl class="xr-attrs"><dt><span>AREA_OR_POINT :</span></dt><dd>Area</dd><dt><span>DataType :</span></dt><dd>Thematic</dd><dt><span>RepresentationType :</span></dt><dd>THEMATIC</dd><dt><span>STATISTICS_COVARIANCES :</span></dt><dd>136.429646247598</dd><dt><span>STATISTICS_MAXIMUM :</span></dt><dd>48</dd><dt><span>STATISTICS_MEAN :</span></dt><dd>25.753373398066</dd><dt><span>STATISTICS_MINIMUM :</span></dt><dd>1</dd><dt><span>STATISTICS_SKIPFACTORX :</span></dt><dd>1</dd><dt><span>STATISTICS_SKIPFACTORY :</span></dt><dd>1</dd><dt><span>STATISTICS_STDDEV :</span></dt><dd>11.680310194836</dd><dt><span>_FillValue :</span></dt><dd>-128</dd><dt><span>scale_factor :</span></dt><dd>1.0</dd><dt><span>add_offset :</span></dt><dd>0.0</dd></dl></div></li></ul></div></div>
</div>
</div>
<p>Looking at the dataset, we see that the x and y coordinates represent the <em>centers</em> of the cells (you can easily tell this from: i) the shape of the data is the same as coordinates ii) the first <code>x</code> coordinate is actually 50 meters offset from the corner value we saw above ). Let’s convert the actual values to a 2D <code>numpy</code> array:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ar <span class="op">=</span> dset.sel(band<span class="op">=</span><span class="dv">1</span>).to_numpy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s verify that the data values are indeed what we expect:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>pprint(np.unique(ar))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-128</span>    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span>    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3</span>    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4</span>    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span>    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6</span>    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7</span>    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8</span>    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">11</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">13</span>
   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">14</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">15</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">22</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">23</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">24</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">26</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">27</span>
   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">28</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">29</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">30</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">31</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">32</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">33</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">34</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">36</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">37</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">38</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">41</span>
   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">42</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">43</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">44</span>   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">48</span><span style="font-weight: bold">]</span>
</pre>
</div>
</div>
<p>Now according to the <a href="https://land.copernicus.eu/eagle/files/eagle-related-projects/pt_clc-conversion-to-fao-lccs3_dec2010">official docs</a> the designation class for vineyards is <code>221</code> so we need to find what value between 1 and 48 this corresponds to. A simple way is to just search for “221”, for example with <code>grep -R "221" $DATADIR/wine_statistics/u2018_clc2018_v2020_20u1_raster100m/*</code> immediately yields as one of the results:</p>
<pre><code>clc_legend_qgis_raster.qml:        &lt;paletteEntry color="#e68000" label="221 - Vineyards" value="15" alpha="255"/&gt;</code></pre>
<p>and thus the value we need is 15. Thus let’s find the indices of the cells which correspond to this value and then get the actual x-y coords</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> np.where(ar <span class="op">==</span> <span class="dv">15</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> dset.x[indices[<span class="dv">1</span>]].to_numpy()</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> dset.y[indices[<span class="dv">0</span>]].to_numpy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, in order to make the map, we need to use the correct projection. We can easily obtain this information as follows:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>geo_attrs <span class="op">=</span> dset.spatial_ref.attrs</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>pprint(pd.Series(geo_attrs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">crs_wkt                           PROJCS<span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">"ETRS89-extended / LAEA Europe"</span>,GEOGCS<span style="font-weight: bold">[</span><span style="color: #808000; text-decoration-color: #808000">...</span>
semi_major_axis                                                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6378137.0</span>
semi_minor_axis                                                       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6356752.31414</span>
inverse_flattening                                                       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">298.257222</span>
reference_ellipsoid_name                                                   GRS <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1980</span>
longitude_of_prime_meridian                                                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.0</span>
prime_meridian_name                                                       Greenwich
geographic_crs_name                                                          ETRS89
horizontal_datum_name                    European Terrestrial Reference System <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1989</span>
projected_crs_name                                    ETRS89-extended <span style="color: #800080; text-decoration-color: #800080">/</span> LAEA Europe
grid_mapping_name                                      lambert_azimuthal_equal_area
latitude_of_projection_origin                                                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">52.0</span>
longitude_of_projection_origin                                                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10.0</span>
false_easting                                                             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4321000.0</span>
false_northing                                                            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3210000.0</span>
spatial_ref                       PROJCS<span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">"ETRS89-extended / LAEA Europe"</span>,GEOGCS<span style="font-weight: bold">[</span><span style="color: #808000; text-decoration-color: #808000">...</span>
GeoTransform                                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">900000.0</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">100.0</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.0</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5500000.0</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.0</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-100.0</span>
dtype: object
</pre>
</div>
</div>
<p>The next step is to create the <code>cartopy</code> transformation object so that we can convert the map of the countries from their default projection to the same projection as our raster dataset.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a globe object with the same ellipsoid</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>globe <span class="op">=</span> cartopy.crs.Globe(ellipse<span class="op">=</span><span class="st">"GRS80"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the correct projection</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>my_ccr <span class="op">=</span> ccrs.LambertAzimuthalEqualArea(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    central_longitude<span class="op">=</span>geo_attrs[<span class="st">"longitude_of_projection_origin"</span>],</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    central_latitude<span class="op">=</span>geo_attrs[<span class="st">"latitude_of_projection_origin"</span>],</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    false_easting<span class="op">=</span>geo_attrs[<span class="st">"false_easting"</span>],</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    false_northing<span class="op">=</span>geo_attrs[<span class="st">"false_northing"</span>],</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    globe<span class="op">=</span>globe,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we make the plot:</p>
<div class="cell" data-execution_count="8">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.axes(projection<span class="op">=</span>my_ccr)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolution to use</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>resol <span class="op">=</span> <span class="st">"50m"</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Country borders</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>bodr <span class="op">=</span> cartopy.feature.NaturalEarthFeature(</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    category<span class="op">=</span><span class="st">"cultural"</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">"gray"</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    lw<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"admin_0_boundary_lines_land"</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    scale<span class="op">=</span>resol,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    facecolor<span class="op">=</span><span class="st">"none"</span>,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Land, i.e. coastlines</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>land <span class="op">=</span> cartopy.feature.NaturalEarthFeature(</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"physical"</span>, <span class="st">"land"</span>, scale<span class="op">=</span>resol, edgecolor<span class="op">=</span><span class="st">"gray"</span>, lw<span class="op">=</span><span class="fl">0.5</span>, facecolor<span class="op">=</span><span class="st">"#fad5b1"</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Ocean</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>ocean <span class="op">=</span> cartopy.feature.NaturalEarthFeature(</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"physical"</span>, <span class="st">"ocean"</span>, scale<span class="op">=</span>resol, edgecolor<span class="op">=</span><span class="st">"none"</span>, facecolor<span class="op">=</span><span class="st">"#f0f8ff"</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>ax.add_feature(land, facecolor<span class="op">=</span><span class="st">"#fad5b1"</span>, zorder<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that ocean is broken for this projection so it fills the entire globe</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Thus we just make it a background</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>ax.add_feature(ocean, linewidth<span class="op">=</span><span class="fl">0.2</span>, zorder<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>ax.add_feature(bodr, zorder<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>ax.scatter(x, y, marker<span class="op">=</span><span class="st">"o"</span>, color<span class="op">=</span><span class="st">"r"</span>, alpha<span class="op">=</span><span class="fl">0.01</span>, s<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>gl <span class="op">=</span> ax.gridlines(</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    draw_labels<span class="op">=</span><span class="va">True</span>, linewidth<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">"gray"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, linestyle<span class="op">=</span><span class="st">":"</span>, zorder<span class="op">=</span><span class="dv">0</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Limits set by eye</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="dv">2400000</span>, <span class="dv">7400000</span>)</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(<span class="dv">1500000</span>, <span class="dv">3500000</span>)</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty ticks so we can label the axes</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>ax.set_xticks([])</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>ax.set_yticks([])</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Longitude"</span>, labelpad<span class="op">=</span><span class="dv">15</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Latitude"</span>, labelpad<span class="op">=</span><span class="dv">35</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Wine-making regions of Europe"</span>, fontsize<span class="op">=</span><span class="dv">30</span>, fontweight<span class="op">=</span><span class="st">"light"</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="wine_production_files/figure-html/cell-9-output-1.png" width="1131" height="542"></p>
</div>
</div>
<p>This looks very similar to Fig.2 in <span class="citation" data-cites="Droulia2022">(<a href="#ref-Droulia2022" role="doc-biblioref">Droulia and Charalampopoulos 2022</a>)</span>, although they appear to have used a different (and unspecified) projection. We see that indeed the majority of the vineyards are situated in southern Europe, and virtually none exist above the latitude of <span class="math inline">\(50 ^{\circ}N\)</span>. As we expect: grapes for wine like hot, sunny weather.</p>
<p>Let’s now look more quantitatively at which countries have the largest amount of vineyards. To do so, we use the data from <a href="https://ec.europa.eu/eurostat">Eurostat</a>. This is a great resource for all statistical data within the EU.</p>
<p>For this purpose, we will use Eurostat’s <a href="https://ec.europa.eu/eurostat/web/products-datasets/-/vit_t1">VIT_T1</a> dataset that lists the land usage by different wine types for every EU member state, as well as the <a href="https://ec.europa.eu/eurostat/web/products-datasets/-/ef_lus_main">EF_LUS_MAIN</a> dataset that gives a more general overview of all agricultural/farm land area use. For instructions on how to obtain this data, see <a href="#sec-eurostat">Section&nbsp;2.2.2</a>.</p>
<p>The detailed code that loads the data, selects the appropriate subsets of both datasets, and merges it into something which is easier to plot below, albeit it’s pretty long.</p>
<div class="cell" data-execution_count="9">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup dataframe to associate 2 letter country codes with country names</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Can be found here: https://www.google.com/url?sa=t&amp;source=web&amp;cd=&amp;ved=2ahUKEwiovcD2kr-BAxVMgv0HHRubDdsQFnoECBQQAQ&amp;url=https%3A%2F%2Fec.europa.eu%2Feurostat%2Fstatistics-explained%2Fimages%2F9%2F9f%2FCountry_Codes_and_Names.xlsx&amp;usg=AOvVaw3E1WY8Fd33SHLq3c0FM01U&amp;opi=89978449</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>eu_countries <span class="op">=</span> pd.read_excel(<span class="ss">f"</span><span class="sc">{</span>DATADIR<span class="sc">}</span><span class="ss">/misc/Country_Codes_and_Names.xlsx"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>eu_countries[<span class="st">"CODE"</span>] <span class="op">=</span> [x.strip() <span class="cf">for</span> x <span class="kw">in</span> eu_countries[<span class="st">"CODE"</span>].values]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>eu_countries.loc[eu_countries[<span class="st">"CODE"</span>] <span class="op">==</span> <span class="st">"DE"</span>, <span class="st">"COUNTRY NAME"</span>] <span class="op">=</span> <span class="st">"Germany"</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Vineyard area</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>df_area <span class="op">=</span> pd.read_json(<span class="ss">f"</span><span class="sc">{</span>DATADIR<span class="sc">}</span><span class="ss">/wine_statistics/VIT_T1.json"</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Pick only data from 2020 for EU countries</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>df_area <span class="op">=</span> df_area[</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    (df_area[<span class="st">"geo"</span>].isin(eu_countries[<span class="st">"CODE"</span>])) <span class="op">&amp;</span> (df_area[<span class="st">"TIME_PERIOD"</span>] <span class="op">==</span> <span class="dv">2020</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Pick only the data for all vineyard types and select the columns we care about</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>df_area_2020 <span class="op">=</span> df_area[df_area[<span class="st">"vinetype"</span>] <span class="op">==</span> <span class="st">"TOTAL"</span>][[<span class="st">"geo"</span>, <span class="st">"value"</span>]]</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Associate the 2 character ISO country codes with country names</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>df_area_2020 <span class="op">=</span> df_area_2020.rename(columns<span class="op">=</span>{<span class="st">"geo"</span>: <span class="st">"CODE"</span>})</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>df_area_2020 <span class="op">=</span> pd.merge(df_area_2020, eu_countries, how<span class="op">=</span><span class="st">"inner"</span>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Permanent crops area</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>df_area_gen <span class="op">=</span> pd.read_json(<span class="ss">f"</span><span class="sc">{</span>DATADIR<span class="sc">}</span><span class="ss">/wine_statistics/EF_LUS_MAIN.json"</span>)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>df_area_gen <span class="op">=</span> df_area_gen[</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    (df_area_gen[<span class="st">"geo"</span>].isin(eu_countries[<span class="st">"CODE"</span>]))</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> (df_area_gen[<span class="st">"TIME_PERIOD"</span>] <span class="op">==</span> <span class="dv">2020</span>)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Select permanent crops among all farm types</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>df_area_gen_2020 <span class="op">=</span> df_area_gen[</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    (df_area_gen[<span class="st">"crops"</span>] <span class="op">==</span> <span class="st">"PECR"</span>) <span class="op">&amp;</span> (df_area_gen[<span class="st">"farmtype"</span>] <span class="op">==</span> <span class="st">"TOTAL"</span>)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>][[<span class="st">"geo"</span>, <span class="st">"value"</span>]]</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>df_area_gen_2020 <span class="op">=</span> df_area_gen_2020.rename(columns<span class="op">=</span>{<span class="st">"geo"</span>: <span class="st">"CODE"</span>})</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>df_area_gen_2020 <span class="op">=</span> pd.merge(df_area_gen_2020, eu_countries, how<span class="op">=</span><span class="st">"inner"</span>)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Find all countries that produce more than the given threshold than group the rest into "Others"</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>total_area <span class="op">=</span> df_area_2020[<span class="st">"value"</span>].<span class="bu">sum</span>()</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>th_area <span class="op">=</span> <span class="fl">0.05</span> <span class="op">*</span> total_area</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>df_to_plot <span class="op">=</span> df_area_2020[df_area_2020[<span class="st">"value"</span>] <span class="op">&gt;=</span> th_area]</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>row <span class="op">=</span> pd.DataFrame(</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">"CODE"</span>: <span class="st">"Others"</span>,</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">"value"</span>: df_area_2020[df_area_2020[<span class="st">"value"</span>] <span class="op">&lt;</span> th_area][<span class="st">"value"</span>].<span class="bu">sum</span>(),</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">"COUNTRY NAME"</span>: <span class="st">"Others"</span>,</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>[<span class="dv">0</span>],</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>df_to_plot <span class="op">=</span> pd.concat([df_to_plot, row], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the total permanent crop area for the same countries that have largest vineyards,</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a><span class="co"># and group the rest under "Others"</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>df_to_plot_gen <span class="op">=</span> df_area_gen_2020[df_area_gen_2020[<span class="st">"CODE"</span>].isin(df_to_plot[<span class="st">"CODE"</span>])]</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>row <span class="op">=</span> pd.DataFrame(</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">"CODE"</span>: <span class="st">"Others"</span>,</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">"value"</span>: df_area_gen_2020[<span class="op">~</span>df_area_gen_2020[<span class="st">"CODE"</span>].isin(df_to_plot[<span class="st">"CODE"</span>])][</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>            <span class="st">"value"</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>        ].<span class="bu">sum</span>(),</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>        <span class="st">"COUNTRY NAME"</span>: <span class="st">"Others"</span>,</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>[<span class="dv">0</span>],</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>df_to_plot_gen <span class="op">=</span> pd.concat([df_to_plot_gen, row], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge everything into 1 dataframe</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>df_to_plot_gen <span class="op">=</span> df_to_plot_gen.rename(columns<span class="op">=</span>{<span class="st">"value"</span>: <span class="st">"total_area"</span>})</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>df_to_plot <span class="op">=</span> pd.merge(df_to_plot, df_to_plot_gen, how<span class="op">=</span><span class="st">"inner"</span>)</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>df_to_plot <span class="op">=</span> df_to_plot.sort_values(<span class="st">"value"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Create labels for the square area graph</span></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> []</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(df_to_plot.shape[<span class="dv">0</span>]):</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>    wine_area <span class="op">=</span> df_to_plot.iloc[i][<span class="st">"value"</span>]</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>    gen_area <span class="op">=</span> df_to_plot.iloc[i][<span class="st">"total_area"</span>]</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>    country <span class="op">=</span> df_to_plot.iloc[i][<span class="st">"COUNTRY NAME"</span>]</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>    wine_in_kha <span class="op">=</span> <span class="bu">int</span>(np.<span class="bu">round</span>(wine_area <span class="op">/</span> <span class="dv">1000</span>, <span class="dv">0</span>))</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>    percent_usage <span class="op">=</span> np.<span class="bu">round</span>(wine_area <span class="op">/</span> gen_area <span class="op">*</span> <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>    label <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>country<span class="sc">}</span><span class="ch">\n</span><span class="sc">{</span>wine_in_kha<span class="sc">}</span><span class="ss"> kha</span><span class="ch">\n</span><span class="ss"> (</span><span class="sc">{</span>percent_usage<span class="sc">}</span><span class="ss">%)"</span></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>    labels.append(label)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Armed with the right data, we can finally visualize the land usage statistics. We will use the <code>matplotlib</code> package along with <a href="https://github.com/laserson/squarify"><code>squarify</code></a> to create two different ways of looking at the data.</p>
<div class="cell" data-execution_count="10">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> squarify</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>axis_fontsize <span class="op">=</span> <span class="dv">16</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>lbl_fontsize <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">13</span>, <span class="dv">6</span>))</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Left: donut plot</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.subplot(<span class="dv">121</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> labelled_pie(</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    df_to_plot[<span class="st">"value"</span>].values,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    df_to_plot[<span class="st">"COUNTRY NAME"</span>].values,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Area under vine in the EU for 2020"</span>,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>ax.text(</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="fl">0.25</span>,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="fl">0.15</span>,</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"Total area</span><span class="ch">\n</span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">round</span>(total_area<span class="op">/</span><span class="fl">1e6</span>,<span class="dv">1</span>)<span class="sc">}</span><span class="ss"> mha"</span>,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    fontweight<span class="op">=</span><span class="st">"light"</span>,</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    fontsize<span class="op">=</span><span class="dv">18</span>,</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Fraction of total vineyard area"</span>, pad<span class="op">=</span><span class="dv">30</span>, fontweight<span class="op">=</span><span class="st">"light"</span>, fontsize<span class="op">=</span><span class="dv">22</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Right: square area plot</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">122</span>)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> squarify.plot(</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    sizes<span class="op">=</span>df_to_plot[<span class="st">"value"</span>],</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span>plt.rcParams[<span class="st">"axes.prop_cycle"</span>].by_key()[<span class="st">"color"</span>],</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span>labels,</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    text_kwargs<span class="op">=</span>{<span class="st">"fontsize"</span>: <span class="dv">16</span>, <span class="st">"color"</span>: <span class="st">"white"</span>, <span class="st">"fontweight"</span>: <span class="st">"normal"</span>},</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">"white"</span>,</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">"both"</span>, labelsize<span class="op">=</span>axis_fontsize)</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>ax2.xaxis.label.set_size(lbl_fontsize)</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>ax2.yaxis.label.set_size(lbl_fontsize)</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>ax2.xaxis.label.set_fontweight(<span class="st">"light"</span>)</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>ax2.yaxis.label.set_fontweight(<span class="st">"light"</span>)</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>ax2.spines[[<span class="st">"left"</span>, <span class="st">"bottom"</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>ax2.xaxis.set_visible(<span class="va">False</span>)</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>ax2.yaxis.set_visible(<span class="va">False</span>)</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(wspace<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>plt.title(</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Area (fraction of all permanent crops)"</span>, pad<span class="op">=</span><span class="dv">20</span>, fontweight<span class="op">=</span><span class="st">"light"</span>, fontsize<span class="op">=</span><span class="dv">22</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> plt.suptitle(</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"Area under vine in the EU for 2020"</span>, fontsize<span class="op">=</span><span class="dv">30</span>, fontweight<span class="op">=</span><span class="st">"light"</span>, y<span class="op">=</span><span class="fl">1.08</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="wine_production_files/figure-html/cell-11-output-1.png" width="1108" height="578"></p>
</div>
</div>
<p>We can clearly see that:</p>
<ul>
<li>Spain, France and Italy have the largest vineyards, together comprising almost 3/4 of all vineyard area in the EU,</li>
<li>For all the top 5 countries, vineyards occupy a sizable fraction of all permanent crop lands, ranging from 20% for Spain to 77% for France.</li>
</ul>
</section>
<section id="production-volume" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="production-volume"><span class="header-section-number">1.3.2</span> Production volume</h3>
<p>Next, let’s take a look at the volume of wine produced within the EU. After all, just because there is a vineyard doesn’t mean it successfully produced wine.</p>
<p>For this, we use a custom dataset which can be obtained from the “Wine Production and opening stocks” <a href="https://agridata.ec.europa.eu/extensions/DashboardWine/WineProduction.html">dashboard</a> of the Directorate-General of Agriculture and Rural Development. See <a href="#sec-dgard">Section&nbsp;2.2.3</a> for details on getting this data.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df_production <span class="op">=</span> pd.read_excel(<span class="ss">f"</span><span class="sc">{</span>DATADIR<span class="sc">}</span><span class="ss">/wine_statistics/production_data_dgard.xlsx"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>df_production.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 2573 entries, 0 to 2572
Data columns (total 10 columns):
 #   Column         Non-Null Count  Dtype  
---  ------         --------------  -----  
 0   Member State   2573 non-null   object 
 1   MS Code        2573 non-null   object 
 2   Category       2573 non-null   object 
 3   Product Group  2573 non-null   object 
 4   Year           2573 non-null   int64  
 5   Production     2573 non-null   float64
 6   Opening Stock  2573 non-null   float64
 7   Availability   2573 non-null   float64
 8   Area           2573 non-null   float64
 9   Yield          2573 non-null   object 
dtypes: float64(4), int64(1), object(5)
memory usage: 201.1+ KB</code></pre>
</div>
</div>
<p>The relevant columns to use are:</p>
<ul>
<li><code>Member State</code> - country reporting</li>
<li><code>Category</code> and <code>Product Group</code> - type of product being produced</li>
<li><code>Year</code> - year reported</li>
<li><code>Production</code>- the volume of wine produced in thousands of hectorliters (1 hl = 100 l).</li>
</ul>
<p>Taking a peek at the type of products being produced, we see:</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>np.unique(df_production[[<span class="st">'Category'</span>,<span class="st">'Product Group'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>array(['-', 'Non-GI', 'Non-Vinified', 'Other wines', 'P.D.O. wines',
       'P.G.I. wines', 'Table wine', 'VQPRD wines', 'Varietal'],
      dtype=object)</code></pre>
</div>
</div>
<p>The most salient difference is thus “Non-Vinified” products (i.e., not wine) vs everything else (i.e., wine).</p>
<p>Let’s narrow things down to only wines, group by country and year, and sum the production over everything else (i.e., <code>Category</code> and <code>Product Group</code>):</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group all wines by country and year</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>df_tmp <span class="op">=</span> df_production[</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    (df_production[<span class="st">"Category"</span>] <span class="op">!=</span> <span class="st">"Non-Vinified"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> (df_production[<span class="st">"Product Group"</span>] <span class="op">!=</span> <span class="st">"Non-Vinified"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>].groupby([<span class="st">"Member State"</span>, <span class="st">"Year"</span>])</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>df_tmp.head()</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Now sum over all the wine types. </span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> df_tmp[<span class="st">"Production"</span>].<span class="bu">sum</span>().reset_index() <span class="co"># reset_index turns this from a Series back into a DataFrame</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>res.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Member State</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Production</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Austria</td>
<td>1999</td>
<td>2803.000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Austria</td>
<td>2000</td>
<td>2335.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Austria</td>
<td>2001</td>
<td>2492.600</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Austria</td>
<td>2002</td>
<td>2566.300</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Austria</td>
<td>2003</td>
<td>2519.615</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let’s focus on 2022 and see which countries have the largest shares of the overall production.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>year <span class="op">=</span> <span class="dv">2022</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>df_year <span class="op">=</span> res[res[<span class="st">"Year"</span>] <span class="op">==</span> year]</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># For plotting we will group together all countries which produce less than 5%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># of the total</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> df_year[<span class="st">"Production"</span>].<span class="bu">sum</span>()</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>th <span class="op">=</span> <span class="fl">0.05</span> <span class="op">*</span> total</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>df_to_plot <span class="op">=</span> df_year[df_year[<span class="st">"Production"</span>] <span class="op">&gt;=</span> th]</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>row <span class="op">=</span> pd.DataFrame(</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Member State"</span>: <span class="st">"Others"</span>,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Year"</span>: year,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Production"</span>: df_year[df_year[<span class="st">"Production"</span>] <span class="op">&lt;</span> th][<span class="st">"Production"</span>].<span class="bu">sum</span>(),</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>[<span class="dv">0</span>],</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>df_to_plot <span class="op">=</span> pd.concat([df_to_plot, row], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort in descending order by volume  produced</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>df_to_plot <span class="op">=</span> df_to_plot.sort_values(<span class="st">"Production"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Total production in mega- hectorliters (so 10^8 liters)</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>total_volume <span class="op">=</span> df_to_plot[<span class="st">"Production"</span>].<span class="bu">sum</span>()<span class="op">/</span><span class="dv">1000</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>df_to_plot.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Member State</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Production</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Italy</td>
<td>2022</td>
<td>49842.611</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>France</td>
<td>2022</td>
<td>44355.621</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>Spain</td>
<td>2022</td>
<td>35780.936</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>Others</td>
<td>2022</td>
<td>20423.086</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>Germany</td>
<td>2022</td>
<td>8551.084</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This data gives the following plot:</p>
<div class="cell" data-execution_count="15">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), subplot_kw<span class="op">=</span><span class="bu">dict</span>(aspect<span class="op">=</span><span class="st">"equal"</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> labelled_pie(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    df_to_plot[<span class="st">"Production"</span>].values,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    df_to_plot[<span class="st">"Member State"</span>].values,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"EU wine production by volume in </span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> plt.text(</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="fl">0.35</span>,</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="fl">0.15</span>,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"Total volume</span><span class="ch">\n</span><span class="sc">{</span><span class="bu">int</span>(np.<span class="bu">round</span>(total_volume,<span class="dv">0</span>))<span class="sc">}</span><span class="ss"> mhl"</span>,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    fontweight<span class="op">=</span><span class="st">"light"</span>,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    fontsize<span class="op">=</span><span class="dv">16</span>,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="wine_production_files/figure-html/cell-16-output-1.png" width="679" height="514"></p>
</div>
</div>
<p>Unsurprisingly we see that the three countries that domainated by area of vineyards also dominate the production: Italy, France and Spain.</p>
<p>To put the total volume produced into context, it is</p>
<ul>
<li>about 60% of the total world wine production<span class="citation" data-cites="oiv2022">(<a href="#ref-oiv2022" role="doc-biblioref">Vine and Wine 2022</a>)</span></li>
<li>approximately 33 L of wine for every person in the EU<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
<li>enough to fill about 6900 Olympic swimming pools<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></li>
</ul>
<p>Let’s now look at the historical trends, focusing on the top three wine producers. In order to make our findings more robust, we also include data from two additional sources:</p>
<ul>
<li>The <a href="https://www.oiv.int/what-we-do/data-discovery-report?oiv">database</a> of the International Organisation of Vine and Wine (OIV). See <a href="#sec-oiv">Section&nbsp;2.2.4</a> for more details.</li>
<li>The <a href="https://economics.adelaide.edu.au/wine-economics/databases#annual-database-of-global-wine-markets-1835-to-2019">database</a> <span class="citation" data-cites="WERI">(<a href="#ref-WERI" role="doc-biblioref">Anderson and A. J. Holmes 2021</a>)</span> from Wine Economics Reasearch Institute at University of Adelaide. This database is a single <code>Excel</code> file with over 100 sheets and contains a wealth of historical information. See <a href="#sec-weri">Section&nbsp;2.2.5</a> for more details.</li>
</ul>
<div class="cell" data-execution_count="16">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the top 3 producers</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>dominant_producers <span class="op">=</span> df_to_plot[<span class="st">"Member State"</span>].values[:<span class="dv">3</span>]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data from the Wine Economics Research Institute</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>df_WERI <span class="op">=</span> pd.ExcelFile(</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"</span><span class="sc">{</span>DATADIR<span class="sc">}</span><span class="ss">/wine_statistics/Megafile_of_global_wine_data_1835_to_2016_1217.xlsx"</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the right sheet</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>df_production_WERI <span class="op">=</span> df_WERI.parse(<span class="st">"T6 Wine production"</span>, header<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the no-name column with year</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>df_production_WERI <span class="op">=</span> df_production_WERI.rename(columns<span class="op">=</span>{<span class="st">"Unnamed: 0"</span>: <span class="st">"Year"</span>})</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>df_tcmp <span class="op">=</span> df_production_WERI[df_production_WERI[<span class="st">"Year"</span>].isin(res[<span class="st">"Year"</span>].values)]</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data from the OIV</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>df_oiv <span class="op">=</span> pd.read_excel(<span class="ss">f"</span><span class="sc">{</span>DATADIR<span class="sc">}</span><span class="ss">/wine_statistics/oiv_data.xlsx"</span>)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to select the appropriate units of volume. Note the strange /xa0 character which shows</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co"># up as a space!</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>df_production_OIV <span class="op">=</span> df_oiv[(df_oiv[<span class="st">"Variable"</span>] <span class="op">==</span> <span class="st">"Production"</span>) <span class="op">&amp;</span> (df_oiv[<span class="st">'Unit'</span>] <span class="op">==</span> <span class="st">"1000</span><span class="ch">\xa0</span><span class="st">hl"</span>)]</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup some defaults</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>golden <span class="op">=</span> (<span class="dv">1</span> <span class="op">+</span> np.sqrt(<span class="dv">5</span>)) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>height <span class="op">=</span> width <span class="op">/</span> golden</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> setup_timeseries_plot(width<span class="op">=</span>width, height<span class="op">=</span>height)</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Note the changes in the quantities being plotted: everything is converted to</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="co"># mega hectorliters (mha, 1e8 litres)</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country <span class="kw">in</span> dominant_producers:</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    tmp <span class="op">=</span> res[res[<span class="st">"Member State"</span>] <span class="op">==</span> country]</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>    (line,) <span class="op">=</span> ax.plot(tmp[<span class="st">"Year"</span>], tmp[<span class="st">"Production"</span>] <span class="op">/</span> <span class="dv">1000</span>, label<span class="op">=</span>country)</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    tmp_oiv <span class="op">=</span> df_production_OIV[df_production_OIV[<span class="st">"Region/Country"</span>] <span class="op">==</span> country]</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>    ax.plot(tmp_oiv[<span class="st">"Year"</span>], tmp_oiv[<span class="st">"Quantity"</span>] <span class="op">/</span> <span class="fl">1e3</span>, ls<span class="op">=</span><span class="st">":"</span>, color<span class="op">=</span>line.get_color())</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>    ax.plot(</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>        df_tcmp[<span class="st">"Year"</span>], df_tcmp[country] <span class="op">*</span> <span class="dv">10</span> <span class="op">/</span> <span class="fl">1e6</span>, ls<span class="op">=</span><span class="st">"--"</span>, color<span class="op">=</span>line.get_color()</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually create the legend to distinguish the datasets</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.lines <span class="im">import</span> Line2D</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>line1 <span class="op">=</span> Line2D([<span class="dv">0</span>], [<span class="dv">0</span>], label<span class="op">=</span><span class="st">'Eurostat'</span>, color<span class="op">=</span><span class="st">'k'</span>)</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>line2 <span class="op">=</span> Line2D([<span class="dv">0</span>], [<span class="dv">0</span>], label<span class="op">=</span><span class="st">'OIV'</span>, color<span class="op">=</span><span class="st">'k'</span>,ls<span class="op">=</span><span class="st">":"</span>)</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>line3 <span class="op">=</span> Line2D([<span class="dv">0</span>], [<span class="dv">0</span>], label<span class="op">=</span><span class="st">'WERI'</span>, color<span class="op">=</span><span class="st">'k'</span>,ls<span class="op">=</span><span class="st">"--"</span>)</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>handles, labels <span class="op">=</span> ax.get_legend_handles_labels()</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>handles.extend([line1,line2,line3])</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>ax.legend(handles<span class="op">=</span>handles,ncol<span class="op">=</span><span class="dv">2</span>,loc<span class="op">=</span><span class="dv">4</span>, prop<span class="op">=</span>{<span class="st">"size"</span>: <span class="dv">14</span>, <span class="st">"weight"</span>: <span class="st">"light"</span>})</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Year"</span>)</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Volume (millions of hectolitres)"</span>)</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ax.set_title(<span class="st">"Top wine producers in the EU"</span>, fontsize<span class="op">=</span><span class="dv">30</span>, fontweight<span class="op">=</span><span class="st">"light"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="wine_production_files/figure-html/cell-17-output-1.png" width="814" height="561"></p>
</div>
</div>
<p>Interestingly the three data sources agree very well for France and Spain but disagree substantially for Italy. If one takes the Eurostat dataset and add back the “Non-Vinified” data, one gets the following:</p>
<div class="cell" data-execution_count="17">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data where _all_ grape production is included</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>res2 <span class="op">=</span> df_production.groupby([<span class="st">"Member State"</span>, <span class="st">"Year"</span>])[<span class="st">"Production"</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> setup_timeseries_plot(width<span class="op">=</span>width, height<span class="op">=</span>height)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Note the changes in the quantities being plotted: everything is converted to</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># mega hectorliters (mha, 1e8 litres)</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>country <span class="op">=</span> <span class="st">"Italy"</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>tmp <span class="op">=</span> res[res[<span class="st">"Member State"</span>] <span class="op">==</span> country]</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>tmp2 <span class="op">=</span> res2[res2[<span class="st">"Member State"</span>] <span class="op">==</span> country]</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>(line,) <span class="op">=</span> ax.plot(tmp[<span class="st">"Year"</span>], tmp[<span class="st">"Production"</span>] <span class="op">/</span> <span class="dv">1000</span>, label<span class="op">=</span><span class="st">"Eurostat"</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>ax.plot(tmp2[<span class="st">"Year"</span>], tmp2[<span class="st">"Production"</span>] <span class="op">/</span> <span class="dv">1000</span>, label<span class="op">=</span><span class="st">"Eurostat, all"</span>, ls<span class="op">=</span><span class="st">"-"</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>tmp_oiv <span class="op">=</span> df_production_OIV[df_production_OIV[<span class="st">"Region/Country"</span>] <span class="op">==</span> country]</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>ax.plot(tmp_oiv[<span class="st">"Year"</span>], tmp_oiv[<span class="st">"Quantity"</span>] <span class="op">/</span> <span class="fl">1e3</span>, ls<span class="op">=</span><span class="st">"--"</span>, label<span class="op">=</span><span class="st">"OIV"</span>)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>ax.plot(df_tcmp[<span class="st">"Year"</span>], df_tcmp[country] <span class="op">*</span> <span class="dv">10</span> <span class="op">/</span> <span class="fl">1e6</span>, ls<span class="op">=</span><span class="st">":"</span>, label<span class="op">=</span><span class="st">"WERI"</span>)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>ax.legend(loc<span class="op">=</span><span class="dv">3</span>, prop<span class="op">=</span>{<span class="st">"size"</span>: <span class="dv">14</span>, <span class="st">"weight"</span>: <span class="st">"light"</span>})</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Year"</span>)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Volume (millions of hectolitres)"</span>)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ax.set_title(<span class="st">"Italy wine production"</span>, fontsize<span class="op">=</span><span class="dv">30</span>, fontweight<span class="op">=</span><span class="st">"light"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="wine_production_files/figure-html/cell-18-output-1.png" width="814" height="562"></p>
</div>
</div>
<p>Thus it appears that there is some sort of inconsistency in the reporting of the production volume, which affects Italy in particular.</p>
<p>The WERI data set actually extends much further into the past for some countries, so it’s interesting to see even more long-term trends:</p>
<div class="cell" data-execution_count="18">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> setup_timeseries_plot(width<span class="op">=</span>width,height<span class="op">=</span>height)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country <span class="kw">in</span> dominant_producers:</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    ax.plot(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>        df_production_WERI[<span class="st">"Year"</span>], df_production_WERI[country] <span class="op">*</span> <span class="dv">10</span> <span class="op">/</span> <span class="fl">1e6</span>, ls<span class="op">=</span><span class="st">"-"</span>,label<span class="op">=</span>country</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Year"</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Volume (millions of hectolitres)"</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ax.legend(loc<span class="op">=</span><span class="dv">2</span>, prop<span class="op">=</span>{<span class="st">"size"</span>: <span class="dv">14</span>, <span class="st">"weight"</span>: <span class="st">"light"</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="wine_production_files/figure-html/cell-19-output-1.png" width="832" height="527"></p>
</div>
</div>
<p>A few interesting things to observe:</p>
<ul>
<li>Historically, Italy and France produced far more wine than Spain</li>
<li>The production of wine reached the highest recorded value around 1975 for Italy and France and has been declining ever since, with current levels at about 50% of the peak.</li>
</ul>
</section>
</section>
<section id="appendix" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Appendix</h1>
<section id="sec-env" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="sec-env"><span class="header-section-number">2.1</span> Analysis environment</h2>
<p>For the <code>Python</code> setup we use <code>mambaforge</code> as a drop-in replacement for the more widely known <code>conda</code>. You can download the latest version from the <a href="https://github.com/conda-forge/miniforge#mambaforge">website</a> or run:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://github.com/conda-forge/miniforge/releases/latest/download/Mambaforge-Linux-x86_64.sh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and then execute the file.</p>
<p>The <code>yaml</code> file with all the dependencies can be found <a href="https://github.com/SergeiOssokine/SergeiOssokine.github.io/blob/main/analysis/setup/environment.yml">here</a>. To install everything, run the following command (if you prefer to use <code>conda</code>, you will need to first do <code>conda config --add channels conda-forge</code> and then replace <code>mamba</code> with <code>conda</code> everywhere below):</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mamba</span> env create <span class="at">-f</span> environment.yml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then activate the environment with</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mamba</span> activate wine-analysis</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="datasets" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="datasets"><span class="header-section-number">2.2</span> Datasets</h2>
<p>The appendix describes in detail how to obtain the datasets used in this blog.</p>
<section id="sec-corine" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="sec-corine"><span class="header-section-number">2.2.1</span> Corine Land Cover</h3>
<p>The Corine Land Cover dataset provides multi-year, land coverage data for Europe, with the latest release being CLC-2018. To obtain the data:</p>
<ol type="1">
<li>Go to the <a href="https://land.copernicus.eu/en/products/corine-land-cover/clc2018">latest data release</a>. Click “Download” in the left side-bar.</li>
<li>Register for the EU Login if you don’t have one /Log in if you already do</li>
<li>Scroll down to “Download pre-packaged data collections” and select “u2018_clc2018_v2020_20u1_raster100m”</li>
<li>Click “Add to cart”</li>
<li>Go to your cart, select this dataset and click “Start downloading”. This will queue your task.</li>
<li>Navigate to “Downloads process page”. There you will see your task go from “Queued” first to “In progress” and then finally to “Completed” at which point you can click the “Download file” link to actually download your data.</li>
<li>Unzip the data and it’s ready for use</li>
</ol>
</section>
<section id="sec-eurostat" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="sec-eurostat"><span class="header-section-number">2.2.2</span> Eurostat data</h3>
<p>By far the easiest way to get the relevant data is through the <a href="https://ec.europa.eu/eurostat/databrowser/view/vit_t1/default/table?lang=en">web interface</a>. Alternatively one could either:</p>
<ol type="a">
<li>Download directly with e.g.&nbsp;<code>curl -o wine_land_usage_area_vit_t1.csv.gz https://ec.europa.eu/eurostat/estat-navtree-portlet-prod/BulkDownloadListing?file=data/vit_t1.tsv.gz</code></li>
<li>Use the REST API, see e.g.&nbsp;<a href="https://wikis.ec.europa.eu/display/EurostatHELP/API+Statistics+-+data+query">here</a> for more information. Note that the parsing of the resulting data can be a bit involved.</li>
<li>Use a language-specific third-party package for Eurostat data, for example for <a href="https://pypi.org/project/eurostat/">Python</a> or for <a href="https://ropengov.github.io/eurostat/articles/eurostat_tutorial.html">R</a></li>
<li>Use a package for parsing SDMX data, for example <a href="https://pandasdmx.readthedocs.io/en/v1.0/">pandasdmx</a>.</li>
</ol>
<p>We use approach d.&nbsp;in order to ensure easy reproducibility and allow us to retrieve any number of datasets from Eurostat. The 2 datasets we use in this analysis are</p>
<ul>
<li><code>VIT_T1</code> for detailed overview of vineyard area in the EU</li>
<li><code>EF_LUS_MAIN</code> for overall land use by the agriculture sector in the EU</li>
</ul>
<p>As an example let’s get the data from <code>VIT_T1</code>. Conveniently, the <code>pandasdmx</code> package already has a client for retriving data from <code>Eurostat</code>. For example:</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandasdmx <span class="im">as</span> sdmx</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>estat <span class="op">=</span> sdmx.Request(<span class="st">"ESTAT"</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>resp <span class="op">=</span> estat.data(<span class="st">"VIT_T1"</span>,key<span class="op">=</span>{<span class="st">'unit'</span>:<span class="st">'HA'</span>}) <span class="co"># Only take land area in units of hectares</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> sdmx.to_pandas(resp).reset_index() <span class="co"># reset_index() makes it a flat dataframe</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">freq</th>
<th data-quarto-table-cell-role="th">vinetype</th>
<th data-quarto-table-cell-role="th">unit</th>
<th data-quarto-table-cell-role="th">geo</th>
<th data-quarto-table-cell-role="th">TIME_PERIOD</th>
<th data-quarto-table-cell-role="th">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A</td>
<td>IN</td>
<td>HA</td>
<td>AT</td>
<td>2015</td>
<td>43489.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>A</td>
<td>IN</td>
<td>HA</td>
<td>AT</td>
<td>2020</td>
<td>44501.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>A</td>
<td>IN</td>
<td>HA</td>
<td>AT11</td>
<td>2015</td>
<td>11799.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>A</td>
<td>IN</td>
<td>HA</td>
<td>AT11</td>
<td>2020</td>
<td>11642.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>A</td>
<td>IN</td>
<td>HA</td>
<td>AT12</td>
<td>2015</td>
<td>26885.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The script to retrieve all the datasets (and associated metadata) and dump it to convenient <code>json</code> files is <a href="https://github.com/SergeiOssokine/SergeiOssokine.github.io/blob/main/analysis/scripts/get_data_eurostat_sdmx.py">here</a>.</p>
</section>
<section id="sec-dgard" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="sec-dgard"><span class="header-section-number">2.2.3</span> Wine production data from Directorate-General for Agriculture and Rural Development</h3>
<p>The DGARD maintains a dashboard that pulls together various statistics on wine production in the EU. To get the data:</p>
<ol type="1">
<li>Navigate to <a href="https://agridata.ec.europa.eu/extensions/DashboardWine/WineProduction.html">the dashboard</a></li>
<li>Click the “triangle” at the top right corner and select “Data explorer”</li>
<li>Click the “Export data” icon on the right of the header row. This will download the <code>Excel</code> file with the data.</li>
</ol>
</section>
<section id="sec-oiv" class="level3" data-number="2.2.4">
<h3 data-number="2.2.4" class="anchored" data-anchor-id="sec-oiv"><span class="header-section-number">2.2.4</span> OIV statistics database</h3>
<p>The International Organization of Vine and Wine (OIV) maintains a database of statistical data about many aspects of wine making. One can download the data used in this analysis as follows:</p>
<ol type="1">
<li>Go to the <a href="https://www.oiv.int/what-we-do/data-discovery-report?oiv">database section</a> of the OIV website</li>
<li>Select “Europe” from the “Continent” drop-down</li>
<li>Click on the “…” at the upper right corner of the table (“More options”) and select “Export data”</li>
<li>Leave the selection on “Data with current layout” and click “Export”</li>
</ol>
</section>
<section id="sec-weri" class="level3" data-number="2.2.5">
<h3 data-number="2.2.5" class="anchored" data-anchor-id="sec-weri"><span class="header-section-number">2.2.5</span> WERI wine database</h3>
<p>The Wine Economics Reasearch Institute at University of Adelaide maintains an extensive database of historical data related to wine. To obtain this data:</p>
<ol type="1">
<li>Go to <a href="https://economics.adelaide.edu.au/wine-economics/databases#annual-database-of-global-wine-markets-1835-to-20190">the database website</a></li>
<li>Click “Download megafile of global wine data”</li>
</ol>


<!-- -->


</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-WERI" class="csl-entry" role="listitem">
Anderson, K., and V. Pinilla with the assistance of A. J. Holmes. 2021. <span>“Annual Database of Global Wine Markets, 1835 to 2019.”</span>
</div>
<div id="ref-DongYang2023Ddao" class="csl-entry" role="listitem">
Dong, Yang, Shengchang Duan, Qiuju Xia, Zhenchang Liang, Xiao Dong, Kristine Margaryan, Mirza Musayev, et al. 2023. <span>“Dual Domestications and Origin of Traits in Grapevine Evolution.”</span> <em>Science (American Association for the Advancement of Science)</em> 379 (6635): 892–901.
</div>
<div id="ref-Droulia2022" class="csl-entry" role="listitem">
Droulia, Fotoula, and Ioannis Charalampopoulos. 2022. <span>“A Review on the Observed Climate Change in Europe and Its Impacts on Viticulture.”</span> <em>Atmosphere</em> 13 (5). <a href="https://doi.org/10.3390/atmos13050837">https://doi.org/10.3390/atmos13050837</a>.
</div>
<div id="ref-oiv2022" class="csl-entry" role="listitem">
Vine, International Organization of, and Wine. 2022. <span>“STATE OFTHE WORLD VINEAND WINE SECTOR IN 2022.”</span> <a href="https://www.oiv.int/sites/default/files/documents/OIV_State_of_the_world_Vine_and_Wine_sector_in_2022_2.pdf">https://www.oiv.int/sites/default/files/documents/OIV_State_of_the_world_Vine_and_Wine_sector_in_2022_2.pdf</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>See the demographics data <a href="https://ec.europa.eu/eurostat/databrowser/view/DEMO_GIND__custom_7127262/default/table">here</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Assuming as standard swimming-pool capacity of <span class="math inline">\(2.5\times 10^{6}\)</span> liters.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb27" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Veni, vidi, bibi"</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Serguei Ossokine"</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">    html:</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">        theme: cosmo</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">        page-layout: full</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">        css: style.css</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">        code-tools: true</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co">        code-summary: "Show the code"</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co">        number-sections: true</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co">        number-offset: 1</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> ../../analysis/ref/articles.bib</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>Wine is one of the most widely enjoyed alcoholic beverages in the world. It carries a rich cultural heritage and a fascinating history that dates back thousands of years. Recent studies have shown that grapes were actually domesticated _twice_ almost concurrently in western Asia and the Caucasus almost 11000 years ago<span class="co">[</span><span class="ot">@DongYang2023Ddao</span><span class="co">]</span>. Early farmers that migrated from western Asia towards the Iberian peninisula brough with them the domesticated grapevines.  These vines were in turn cross-bred with local varieties which created muscat grapes which were high in sugar. These were the earliest progenitors of the different grape varieties that are found today in many European wine-making regions. Grapes for wine making continued to be cultivated througout Europe and then spread across the globe. Today wine-making is a large industry, worth billions of euros in exports per year. </span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>But it is notably dependent on the climate. Knowing how it will grow under expected, familiar conditions gives it the consistency necessary for industry. How and where has wine been made - and which kinds of wine - across Europe? How much can we expect in trade per year? And what will happen in future years, with the threat of climate change?</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>In this series of blogposts, we will look at many different aspects of wine production in Europe using the latest public datasets. In particular, we will follow the following roadmap (click to get more details):</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part I: Vineyards and wine production</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>In this part, we will explore where in Europe wine production takes place, as well as the volume of wine produced by different countries. We will also look into historical trends in wine production.</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part II: Wine export and consumption</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>In this part, we will look into the details of wine trade as well as trends in wine consumption.</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part III: Climate and wine</span></span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>In this part, we will take a deep dive into what climactic factors affect wine and will examine their effects on historical data.</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part IV: Climate change and the future</span></span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>We will conclude by taking a look what different state-of-the-art climate models predict for the coming decades and what implications this has for wine making.</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a><span class="fu">## Setting up the analysis environment</span></span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>To perform this analysis, we will use <span class="in">`Python`</span> and many of the standard data science packages written for it. In particular we will rely heavily on <span class="co">[</span><span class="ot">pandas</span><span class="co">](https://pandas.pydata.org/)</span> and <span class="co">[</span><span class="ot">matplotlib</span><span class="co">](https://matplotlib.org/)</span>. </span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>If you have not encountered these before it is highly recommended to get familiar with them first.</span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a>In order to ensure a reproducible analysis, we encourage people to use an isolated <span class="in">`Python`</span> environment (a virtual environment). While there are many different ways of doing this, we recommend using <span class="in">`conda/mamba`</span> since it also allows for convenient management of <span class="in">`C`</span> dependencies. A detailed description of how to set up the environment can be found in @sec-env.</span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a>Let's load all the packages we need and set up some defaults (the <span class="in">`matplotlib`</span> style file and additional analysis functions are <span class="co">[</span><span class="ot">here</span><span class="co">](https://github.com/SergeiOssokine/SergeiOssokine.github.io/tree/main/analysis)</span>):</span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cartopy.crs <span class="im">as</span> ccrs</span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cartopy.feature <span class="im">as</span> cf</span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cartopy</span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rich <span class="im">import</span> <span class="bu">print</span> <span class="im">as</span> pprint</span>
<span id="cb27-74"><a href="#cb27-74" aria-hidden="true" tabindex="-1"></a>DATADIR <span class="op">=</span> <span class="st">"../../../wine_analysis/data/"</span></span>
<span id="cb27-75"><a href="#cb27-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Use out custom matplotlib style</span></span>
<span id="cb27-76"><a href="#cb27-76" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">"../../analysis/setup/wine_analysis.mplstyle"</span>)</span>
<span id="cb27-77"><a href="#cb27-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Use some matplotlib helpers</span></span>
<span id="cb27-78"><a href="#cb27-78" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb27-79"><a href="#cb27-79" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">"../../analysis/scripts/"</span>)</span>
<span id="cb27-80"><a href="#cb27-80" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib_extensions <span class="im">import</span> <span class="op">*</span></span>
<span id="cb27-81"><a href="#cb27-81" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-82"><a href="#cb27-82" aria-hidden="true" tabindex="-1"></a><span class="fu">## Wine production in Europe</span></span>
<span id="cb27-83"><a href="#cb27-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-84"><a href="#cb27-84" aria-hidden="true" tabindex="-1"></a><span class="fu">### Where is it?</span></span>
<span id="cb27-85"><a href="#cb27-85" aria-hidden="true" tabindex="-1"></a>The EU is the largest producer and exporter of wine in the world. Making and consuming wine is a long-held tradition in many European countries. Traditionally, this production has been mostly limited to southern parts of the EU where the conditions are optimal for growing different types of wine. Wine needs warm weather, lots of sun, and a fair amount of rain.</span>
<span id="cb27-86"><a href="#cb27-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-87"><a href="#cb27-87" aria-hidden="true" tabindex="-1"></a>Our first goal is to map the modern location of European vineyards. To do this, we will of course need an extensive dataset of vineyard locations. While it's possible to attempt to build such a dataset from scratch - starting for example from registration data for wineries in the EU - satellite land usage maps already provide a very complete data set. These surveys divide the surface of the Earth into a grid and classify the satellite data within each cell into different classes based on what the land is used for.</span>
<span id="cb27-88"><a href="#cb27-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-89"><a href="#cb27-89" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">Corine Land Cover (CLC) inventory</span><span class="co">](https://land.copernicus.eu/pan-european/corine-land-cover)</span> is the largest database of land cover and land use available for Europe. The first release was 1990 and since then it has been updated several times: 2000, 2006, 2012, and the latest release in 2018. What makes the CLC particularly useful for us is that it explicitly separates vineyards from other types of agricultural use. CLC data is and available freely for research use. We'll use the CLC 2018 dataset to create a map of wine production in Europe.</span>
<span id="cb27-90"><a href="#cb27-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-91"><a href="#cb27-91" aria-hidden="true" tabindex="-1"></a>The data is available in three different formats: raster (<span class="co">[</span><span class="ot">GEOTiff</span><span class="co">](https://www.loc.gov/preservation/digital/formats/fdd/fdd000279.shtml)</span>), SQLite or <span class="co">[</span><span class="ot">ESRI database</span><span class="co">](https://docs.fileformat.com/database/gdb/)</span>. For simplicity we use the GEOTiff raster format, which represents the data as values on a regularly-spaced grid. It comes with extensive documentation, including how to load and examine the data using the <span class="co">[</span><span class="ot">QGIS</span><span class="co">](https://qgis.org/en/site/)</span> open-source application. See @sec-corine for details on obtaining the data.</span>
<span id="cb27-92"><a href="#cb27-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-93"><a href="#cb27-93" aria-hidden="true" tabindex="-1"></a>Before diving into the details, it is worth taking a quick look at the data inside the file. This can be done with <span class="in">`gdalinfo`</span>, a command-line utility that comes as part of the <span class="co">[</span><span class="ot">GDAL library</span><span class="co">](https://gdal.org/index.html)</span> (it was installed as one of the dependencies in the <span class="in">`mamba`</span> environment above). Executing the following:</span>
<span id="cb27-94"><a href="#cb27-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-95"><a href="#cb27-95" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb27-96"><a href="#cb27-96" aria-hidden="true" tabindex="-1"></a><span class="ex">gdalinfo</span> <span class="va">${DATADIR}</span>/wine_statistics/u2018_clc2018_v2020_20u1_raster100m/DATA/u2018_clc2018_v2020_20u1_raster100m.tif <span class="kw">|</span> <span class="fu">nl</span></span>
<span id="cb27-97"><a href="#cb27-97" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-98"><a href="#cb27-98" aria-hidden="true" tabindex="-1"></a>yields (we suppress some output for clarity but the line numbers correspond to what one would see)</span>
<span id="cb27-99"><a href="#cb27-99" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb27-100"><a href="#cb27-100" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Driver: GTiff/GeoTIFF</span>
<span id="cb27-101"><a href="#cb27-101" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>   Files: ../../../data/wine_statistics/u2018_clc2018_v2020_20u1_raster100m/DATA/U2018_CLC2018_V2020_20u1.tif</span>
<span id="cb27-102"><a href="#cb27-102" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>         ../../../data/wine_statistics/u2018_clc2018_v2020_20u1_raster100m/DATA/U2018_CLC2018_V2020_20u1.tif.ovr</span>
<span id="cb27-103"><a href="#cb27-103" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         ../../../data/wine_statistics/u2018_clc2018_v2020_20u1_raster100m/DATA/U2018_CLC2018_V2020_20u1.tif.aux.xml</span>
<span id="cb27-104"><a href="#cb27-104" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>   Size is 65000, 46000 <span class="co"># &lt;1&gt;</span></span>
<span id="cb27-105"><a href="#cb27-105" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>   Coordinate System is: <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-106"><a href="#cb27-106" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>   PROJCRS[<span class="st">"ETRS89-extended / LAEA Europe"</span>, <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-107"><a href="#cb27-107" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>      BASEGEOGCRS[<span class="st">"ETRS89"</span>, <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-108"><a href="#cb27-108" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>          DATUM[<span class="st">"European Terrestrial Reference System 1989"</span>, <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-109"><a href="#cb27-109" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>             ELLIPSOID[<span class="st">"GRS 1980"</span>,6378137,298.257222101004, <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-110"><a href="#cb27-110" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>                 LENGTHUNIT<span class="pp">[</span><span class="st">"metre"</span><span class="ss">,1</span><span class="pp">]</span>]], <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-111"><a href="#cb27-111" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>         PRIMEM[<span class="st">"Greenwich"</span>,0, <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-112"><a href="#cb27-112" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>             ANGLEUNIT<span class="pp">[</span><span class="st">"degree"</span><span class="ss">,0.0174532925199433</span><span class="pp">]</span>], <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-113"><a href="#cb27-113" aria-hidden="true" tabindex="-1"></a><span class="ex">14</span>         ID<span class="pp">[</span><span class="st">"EPSG"</span><span class="ss">,4258</span><span class="pp">]</span>], <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-114"><a href="#cb27-114" aria-hidden="true" tabindex="-1"></a><span class="ex">15</span>     CONVERSION[<span class="st">"Lambert Azimuthal Equal Area"</span>, <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-115"><a href="#cb27-115" aria-hidden="true" tabindex="-1"></a><span class="ex">16</span>         METHOD[<span class="st">"Lambert Azimuthal Equal Area"</span>, <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-116"><a href="#cb27-116" aria-hidden="true" tabindex="-1"></a><span class="ex">17</span>             ID<span class="pp">[</span><span class="st">"EPSG"</span><span class="ss">,9820</span><span class="pp">]</span>], <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-117"><a href="#cb27-117" aria-hidden="true" tabindex="-1"></a><span class="ex">18</span>         PARAMETER[<span class="st">"Latitude of natural origin"</span>,52, <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-118"><a href="#cb27-118" aria-hidden="true" tabindex="-1"></a><span class="ex">19</span>             ANGLEUNIT<span class="pp">[</span><span class="st">"degree"</span><span class="ss">,0.0174532925199433</span><span class="pp">]</span>, <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-119"><a href="#cb27-119" aria-hidden="true" tabindex="-1"></a><span class="ex">20</span>             ID<span class="pp">[</span><span class="st">"EPSG"</span><span class="ss">,8801</span><span class="pp">]</span>], <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-120"><a href="#cb27-120" aria-hidden="true" tabindex="-1"></a><span class="ex">21</span>         PARAMETER[<span class="st">"Longitude of natural origin"</span>,10, <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-121"><a href="#cb27-121" aria-hidden="true" tabindex="-1"></a><span class="ex">22</span>             ANGLEUNIT<span class="pp">[</span><span class="st">"degree"</span><span class="ss">,0.0174532925199433</span><span class="pp">]</span>, <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-122"><a href="#cb27-122" aria-hidden="true" tabindex="-1"></a><span class="ex">23</span>             ID<span class="pp">[</span><span class="st">"EPSG"</span><span class="ss">,8802</span><span class="pp">]</span>], <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-123"><a href="#cb27-123" aria-hidden="true" tabindex="-1"></a><span class="ex">24</span>         PARAMETER[<span class="st">"False easting"</span>,4321000, <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-124"><a href="#cb27-124" aria-hidden="true" tabindex="-1"></a><span class="ex">25</span>             LENGTHUNIT<span class="pp">[</span><span class="st">"metre"</span><span class="ss">,1</span><span class="pp">]</span>, <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-125"><a href="#cb27-125" aria-hidden="true" tabindex="-1"></a><span class="ex">26</span>             ID<span class="pp">[</span><span class="st">"EPSG"</span><span class="ss">,8806</span><span class="pp">]</span>], <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-126"><a href="#cb27-126" aria-hidden="true" tabindex="-1"></a><span class="ex">27</span>         PARAMETER[<span class="st">"False northing"</span>,3210000, <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-127"><a href="#cb27-127" aria-hidden="true" tabindex="-1"></a><span class="ex">28</span>             LENGTHUNIT<span class="pp">[</span><span class="st">"metre"</span><span class="ss">,1</span><span class="pp">]</span>, <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-128"><a href="#cb27-128" aria-hidden="true" tabindex="-1"></a><span class="ex">29</span>             ID<span class="pp">[</span><span class="st">"EPSG"</span><span class="ss">,8807</span><span class="pp">]</span>]], <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-129"><a href="#cb27-129" aria-hidden="true" tabindex="-1"></a><span class="ex">30</span>     CS<span class="pp">[</span><span class="ss">Cartesian,2</span><span class="pp">]</span>, <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-130"><a href="#cb27-130" aria-hidden="true" tabindex="-1"></a><span class="ex">31</span>         AXIS[<span class="st">"(E)"</span>,east, <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-131"><a href="#cb27-131" aria-hidden="true" tabindex="-1"></a><span class="ex">32</span>             ORDER<span class="pp">[</span><span class="ss">1</span><span class="pp">]</span>, <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-132"><a href="#cb27-132" aria-hidden="true" tabindex="-1"></a><span class="ex">33</span>             LENGTHUNIT<span class="pp">[</span><span class="st">"metre"</span><span class="ss">,1</span><span class="pp">]</span>], <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-133"><a href="#cb27-133" aria-hidden="true" tabindex="-1"></a><span class="ex">34</span>         AXIS[<span class="st">"(N)"</span>,north, <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-134"><a href="#cb27-134" aria-hidden="true" tabindex="-1"></a><span class="ex">35</span>             ORDER<span class="pp">[</span><span class="ss">2</span><span class="pp">]</span>, <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-135"><a href="#cb27-135" aria-hidden="true" tabindex="-1"></a><span class="ex">36</span>             LENGTHUNIT<span class="pp">[</span><span class="st">"metre"</span><span class="ss">,1</span><span class="pp">]</span>], <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-136"><a href="#cb27-136" aria-hidden="true" tabindex="-1"></a><span class="ex">37</span>     ID<span class="pp">[</span><span class="st">"EPSG"</span><span class="ss">,3035</span><span class="pp">]</span>] <span class="co"># &lt;2&gt;</span></span>
<span id="cb27-137"><a href="#cb27-137" aria-hidden="true" tabindex="-1"></a><span class="ex">[--------------------------------SNIP-----------------------------------------------------]</span></span>
<span id="cb27-138"><a href="#cb27-138" aria-hidden="true" tabindex="-1"></a><span class="ex">47</span>  Corner Coordinates:</span>
<span id="cb27-139"><a href="#cb27-139" aria-hidden="true" tabindex="-1"></a><span class="ex">48</span>  Upper Left  <span class="er">(</span>  <span class="ex">900000.000,</span> 5500000.000<span class="kw">)</span> <span class="kw">(</span> <span class="ex">56d30</span><span class="st">'18.51"W, 56d29'</span> 4.75<span class="st">"N)</span></span>
<span id="cb27-140"><a href="#cb27-140" aria-hidden="true" tabindex="-1"></a><span class="st">[--------------------------------SNIP-----------------------------------------------------]</span></span>
<span id="cb27-141"><a href="#cb27-141" aria-hidden="true" tabindex="-1"></a><span class="st">53  Band 1 Block=128x128 Type=Int8, ColorInterp=Gray # &lt;3&gt;</span></span>
<span id="cb27-142"><a href="#cb27-142" aria-hidden="true" tabindex="-1"></a><span class="st">54   Min=1.000 Max=48.000  # &lt;3&gt;</span></span>
<span id="cb27-143"><a href="#cb27-143" aria-hidden="true" tabindex="-1"></a><span class="st">55   Minimum=1.000, Maximum=48.000, Mean=25.753, StdDev=11.680</span></span>
<span id="cb27-144"><a href="#cb27-144" aria-hidden="true" tabindex="-1"></a><span class="st">56   NoData Value=-128  # &lt;4&gt;</span></span>
<span id="cb27-145"><a href="#cb27-145" aria-hidden="true" tabindex="-1"></a><span class="st">[--------------------------------SNIP-----------------------------------------------------]</span></span>
<span id="cb27-146"><a href="#cb27-146" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb27-147"><a href="#cb27-147" aria-hidden="true" tabindex="-1"></a><span class="ex">1.</span> Line 5 : the data is on a <span class="va">$6</span>5000<span class="dt">\t</span>imes46000$ grid, corresponding to a spatial resolution of 100 meters.</span>
<span id="cb27-148"><a href="#cb27-148" aria-hidden="true" tabindex="-1"></a><span class="ex">2.</span> Lines 6-35: detailed description of the  coordinate system used to represent the spatial data, given in [Well-known text <span class="er">(</span><span class="ex">WKT</span><span class="kw">)</span><span class="ex">]</span><span class="er">(</span><span class="ex">https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry</span><span class="kw">)</span> <span class="ex">format.</span> See [this post]<span class="er">(</span><span class="kw">)</span> <span class="cf">for</span> more <span class="ex">information</span> on coordinate systems frequently used in GIS.</span>
<span id="cb27-149"><a href="#cb27-149" aria-hidden="true" tabindex="-1"></a><span class="ex">3.</span> Lines 53-54: the land use classes are encoded as integers of type <span class="kw">`</span><span class="st">Int8</span><span class="kw">`</span> <span class="ex">with</span> values ranging from 1 to 48. We will need to figure out what number corresponds to vineyards.</span>
<span id="cb27-150"><a href="#cb27-150" aria-hidden="true" tabindex="-1"></a><span class="ex">4.</span> Line 56: missing values are indicated by <span class="at">-128.</span></span>
<span id="cb27-151"><a href="#cb27-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-152"><a href="#cb27-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-153"><a href="#cb27-153" aria-hidden="true" tabindex="-1"></a><span class="ex">:::</span> {.callout-note collapse=<span class="st">"true"</span>}</span>
<span id="cb27-154"><a href="#cb27-154" aria-hidden="true" tabindex="-1"></a><span class="co"># Note</span></span>
<span id="cb27-155"><a href="#cb27-155" aria-hidden="true" tabindex="-1"></a><span class="ex">One</span> should be careful when loading this data into any tool that treats all numerical values as <span class="kw">`</span><span class="st">float64</span><span class="kw">`</span> <span class="ex">types,</span> because while a <span class="va">$6</span>5000<span class="dt">\t</span>imes46000$ array of <span class="kw">`</span><span class="st">Int8</span><span class="kw">`</span> <span class="ex">occupies</span> ~3 GB, the same array of <span class="kw">`</span><span class="st">float64</span><span class="kw">`</span> <span class="bu">type</span> would occupy 8 times more: ~24 GB.</span>
<span id="cb27-156"><a href="#cb27-156" aria-hidden="true" tabindex="-1"></a><span class="ex">:::</span></span>
<span id="cb27-157"><a href="#cb27-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-158"><a href="#cb27-158" aria-hidden="true" tabindex="-1"></a><span class="kw">`</span><span class="st">xarray</span><span class="kw">`</span> <span class="ex">package</span> provides a great way of interacting with this sort of data via <span class="kw">`</span><span class="st">xarray.DataArray</span><span class="kw">`</span> <span class="fu">which</span> is a multi-dimensional labelled datatype. One can think of it either as a generalization of a multi-dimensional numpy array where more data about the dimensions is stored. There is also a package <span class="kw">`</span><span class="st">rioxarray</span><span class="kw">`</span> <span class="fu">which</span> can load raster file types like <span class="kw">`</span><span class="st">GEOTiff</span><span class="kw">`</span> <span class="ex">directly</span> into <span class="kw">`</span><span class="st">xarray</span><span class="kw">`</span> <span class="ex">objects:</span></span>
<span id="cb27-159"><a href="#cb27-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-162"><a href="#cb27-162" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-163"><a href="#cb27-163" aria-hidden="true" tabindex="-1"></a><span class="st"># Get the data</span></span>
<span id="cb27-164"><a href="#cb27-164" aria-hidden="true" tabindex="-1"></a><span class="st">dset = rioxarray.open_rasterio(</span></span>
<span id="cb27-165"><a href="#cb27-165" aria-hidden="true" tabindex="-1"></a><span class="st">    f"</span>{DATADIR}/wine_statistics/u2018_clc2018_v2020_20u1_raster100m/DATA/U2018_CLC2018_V2020_20u1.tif<span class="st">"</span></span>
<span id="cb27-166"><a href="#cb27-166" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb27-167"><a href="#cb27-167" aria-hidden="true" tabindex="-1"></a><span class="st">dset</span></span>
<span id="cb27-168"><a href="#cb27-168" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb27-169"><a href="#cb27-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-170"><a href="#cb27-170" aria-hidden="true" tabindex="-1"></a><span class="ex">Looking</span> at the dataset, we see that the x and y coordinates represent the _centers_ of the cells <span class="er">(</span><span class="ex">you</span> can easily tell this from: i<span class="kw">)</span> <span class="ex">the</span> shape of the data is the same as coordinates ii<span class="er">)</span> <span class="ex">the</span> first <span class="kw">`</span><span class="st">x</span><span class="kw">`</span> <span class="ex">coordinate</span> is actually 50 meters offset from the corner value we saw above <span class="er">)</span><span class="bu">.</span> Let<span class="st">'s convert the actual values to a 2D `numpy` array:</span></span>
<span id="cb27-171"><a href="#cb27-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-174"><a href="#cb27-174" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-175"><a href="#cb27-175" aria-hidden="true" tabindex="-1"></a><span class="st">ar = dset.sel(band=1).to_numpy()</span></span>
<span id="cb27-176"><a href="#cb27-176" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb27-177"><a href="#cb27-177" aria-hidden="true" tabindex="-1"></a><span class="st">Let'</span>s verify that the data values are indeed what we expect:</span>
<span id="cb27-180"><a href="#cb27-180" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-181"><a href="#cb27-181" aria-hidden="true" tabindex="-1"></a><span class="st">pprint(np.unique(ar))</span></span>
<span id="cb27-182"><a href="#cb27-182" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb27-183"><a href="#cb27-183" aria-hidden="true" tabindex="-1"></a><span class="ex">Now</span> according to the [official docs]<span class="er">(</span><span class="ex">https://land.copernicus.eu/eagle/files/eagle-related-projects/pt_clc-conversion-to-fao-lccs3_dec2010</span><span class="kw">)</span> <span class="ex">the</span> designation class for vineyards is <span class="kw">`</span><span class="st">221</span><span class="kw">`</span> <span class="ex">so</span> we need to find what value between 1 and 48 this corresponds to. A simple way is to just search for <span class="st">"221"</span>, for example with <span class="kw">`</span><span class="st">grep -R "</span>221<span class="st">" </span><span class="va">$DATADIR</span><span class="st">/wine_statistics/u2018_clc2018_v2020_20u1_raster100m/*</span><span class="kw">`</span> <span class="ex">immediately</span> yields as one of the results:</span>
<span id="cb27-184"><a href="#cb27-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-185"><a href="#cb27-185" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb27-186"><a href="#cb27-186" aria-hidden="true" tabindex="-1"></a><span class="st">clc_legend_qgis_raster.qml:        &lt;paletteEntry color="</span>#e68000<span class="st">" label="</span>221 <span class="at">-</span> Vineyards<span class="st">" value="</span>15<span class="st">" alpha="</span>255<span class="st">"/&gt;</span></span>
<span id="cb27-187"><a href="#cb27-187" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb27-188"><a href="#cb27-188" aria-hidden="true" tabindex="-1"></a><span class="ex">and</span> thus the value we need is 15. Thus let<span class="st">'s find the indices of the cells which correspond to this value and then get the actual x-y coords</span></span>
<span id="cb27-189"><a href="#cb27-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-192"><a href="#cb27-192" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-193"><a href="#cb27-193" aria-hidden="true" tabindex="-1"></a><span class="st">indices = np.where(ar == 15)</span></span>
<span id="cb27-194"><a href="#cb27-194" aria-hidden="true" tabindex="-1"></a><span class="st">x = dset.x[indices[1]].to_numpy()</span></span>
<span id="cb27-195"><a href="#cb27-195" aria-hidden="true" tabindex="-1"></a><span class="st">y = dset.y[indices[0]].to_numpy()</span></span>
<span id="cb27-196"><a href="#cb27-196" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb27-197"><a href="#cb27-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-198"><a href="#cb27-198" aria-hidden="true" tabindex="-1"></a><span class="st">Now, in order to make the map, we need to use the correct projection. We can easily obtain this information as follows:</span></span>
<span id="cb27-199"><a href="#cb27-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-202"><a href="#cb27-202" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-203"><a href="#cb27-203" aria-hidden="true" tabindex="-1"></a><span class="st">geo_attrs = dset.spatial_ref.attrs</span></span>
<span id="cb27-204"><a href="#cb27-204" aria-hidden="true" tabindex="-1"></a><span class="st">pprint(pd.Series(geo_attrs))</span></span>
<span id="cb27-205"><a href="#cb27-205" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb27-206"><a href="#cb27-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-207"><a href="#cb27-207" aria-hidden="true" tabindex="-1"></a><span class="st">The next step is to create the `cartopy` transformation object so that we can convert the map of the countries from their default projection to the same projection as our raster dataset.</span></span>
<span id="cb27-210"><a href="#cb27-210" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-211"><a href="#cb27-211" aria-hidden="true" tabindex="-1"></a><span class="st"># Create a globe object with the same ellipsoid</span></span>
<span id="cb27-212"><a href="#cb27-212" aria-hidden="true" tabindex="-1"></a><span class="st">globe = cartopy.crs.Globe(ellipse="GRS80")</span></span>
<span id="cb27-213"><a href="#cb27-213" aria-hidden="true" tabindex="-1"></a><span class="st"># Create the correct projection</span></span>
<span id="cb27-214"><a href="#cb27-214" aria-hidden="true" tabindex="-1"></a><span class="st">my_ccr = ccrs.LambertAzimuthalEqualArea(</span></span>
<span id="cb27-215"><a href="#cb27-215" aria-hidden="true" tabindex="-1"></a><span class="st">    central_longitude=geo_attrs["longitude_of_projection_origin"],</span></span>
<span id="cb27-216"><a href="#cb27-216" aria-hidden="true" tabindex="-1"></a><span class="st">    central_latitude=geo_attrs["latitude_of_projection_origin"],</span></span>
<span id="cb27-217"><a href="#cb27-217" aria-hidden="true" tabindex="-1"></a><span class="st">    false_easting=geo_attrs["false_easting"],</span></span>
<span id="cb27-218"><a href="#cb27-218" aria-hidden="true" tabindex="-1"></a><span class="st">    false_northing=geo_attrs["false_northing"],</span></span>
<span id="cb27-219"><a href="#cb27-219" aria-hidden="true" tabindex="-1"></a><span class="st">    globe=globe,</span></span>
<span id="cb27-220"><a href="#cb27-220" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb27-221"><a href="#cb27-221" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb27-222"><a href="#cb27-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-223"><a href="#cb27-223" aria-hidden="true" tabindex="-1"></a><span class="st">Finally, we make the plot:</span></span>
<span id="cb27-224"><a href="#cb27-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-227"><a href="#cb27-227" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-228"><a href="#cb27-228" aria-hidden="true" tabindex="-1"></a><span class="st">#| code-fold: true</span></span>
<span id="cb27-229"><a href="#cb27-229" aria-hidden="true" tabindex="-1"></a><span class="st">#| code-summary: "Show the code"</span></span>
<span id="cb27-230"><a href="#cb27-230" aria-hidden="true" tabindex="-1"></a><span class="st">plt.figure(figsize=(12, 8))</span></span>
<span id="cb27-231"><a href="#cb27-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-232"><a href="#cb27-232" aria-hidden="true" tabindex="-1"></a><span class="st">ax = plt.axes(projection=my_ccr)</span></span>
<span id="cb27-233"><a href="#cb27-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-234"><a href="#cb27-234" aria-hidden="true" tabindex="-1"></a><span class="st"># Resolution to use</span></span>
<span id="cb27-235"><a href="#cb27-235" aria-hidden="true" tabindex="-1"></a><span class="st">resol = "50m"</span></span>
<span id="cb27-236"><a href="#cb27-236" aria-hidden="true" tabindex="-1"></a><span class="st"># Country borders</span></span>
<span id="cb27-237"><a href="#cb27-237" aria-hidden="true" tabindex="-1"></a><span class="st">bodr = cartopy.feature.NaturalEarthFeature(</span></span>
<span id="cb27-238"><a href="#cb27-238" aria-hidden="true" tabindex="-1"></a><span class="st">    category="cultural",</span></span>
<span id="cb27-239"><a href="#cb27-239" aria-hidden="true" tabindex="-1"></a><span class="st">    edgecolor="gray",</span></span>
<span id="cb27-240"><a href="#cb27-240" aria-hidden="true" tabindex="-1"></a><span class="st">    lw=0.5,</span></span>
<span id="cb27-241"><a href="#cb27-241" aria-hidden="true" tabindex="-1"></a><span class="st">    name="admin_0_boundary_lines_land",</span></span>
<span id="cb27-242"><a href="#cb27-242" aria-hidden="true" tabindex="-1"></a><span class="st">    scale=resol,</span></span>
<span id="cb27-243"><a href="#cb27-243" aria-hidden="true" tabindex="-1"></a><span class="st">    facecolor="none",</span></span>
<span id="cb27-244"><a href="#cb27-244" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb27-245"><a href="#cb27-245" aria-hidden="true" tabindex="-1"></a><span class="st"># Land, i.e. coastlines</span></span>
<span id="cb27-246"><a href="#cb27-246" aria-hidden="true" tabindex="-1"></a><span class="st">land = cartopy.feature.NaturalEarthFeature(</span></span>
<span id="cb27-247"><a href="#cb27-247" aria-hidden="true" tabindex="-1"></a><span class="st">    "physical", "land", scale=resol, edgecolor="gray", lw=0.5, facecolor="#fad5b1"</span></span>
<span id="cb27-248"><a href="#cb27-248" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb27-249"><a href="#cb27-249" aria-hidden="true" tabindex="-1"></a><span class="st"># Ocean</span></span>
<span id="cb27-250"><a href="#cb27-250" aria-hidden="true" tabindex="-1"></a><span class="st">ocean = cartopy.feature.NaturalEarthFeature(</span></span>
<span id="cb27-251"><a href="#cb27-251" aria-hidden="true" tabindex="-1"></a><span class="st">    "physical", "ocean", scale=resol, edgecolor="none", facecolor="#f0f8ff"</span></span>
<span id="cb27-252"><a href="#cb27-252" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb27-253"><a href="#cb27-253" aria-hidden="true" tabindex="-1"></a><span class="st">ax.add_feature(land, facecolor="#fad5b1", zorder=1)</span></span>
<span id="cb27-254"><a href="#cb27-254" aria-hidden="true" tabindex="-1"></a><span class="st"># Note that ocean is broken for this projection so it fills the entire globe</span></span>
<span id="cb27-255"><a href="#cb27-255" aria-hidden="true" tabindex="-1"></a><span class="st"># Thus we just make it a background</span></span>
<span id="cb27-256"><a href="#cb27-256" aria-hidden="true" tabindex="-1"></a><span class="st">ax.add_feature(ocean, linewidth=0.2, zorder=-1)</span></span>
<span id="cb27-257"><a href="#cb27-257" aria-hidden="true" tabindex="-1"></a><span class="st">ax.add_feature(bodr, zorder=2)</span></span>
<span id="cb27-258"><a href="#cb27-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-259"><a href="#cb27-259" aria-hidden="true" tabindex="-1"></a><span class="st">ax.scatter(x, y, marker="o", color="r", alpha=0.01, s=0.1)</span></span>
<span id="cb27-260"><a href="#cb27-260" aria-hidden="true" tabindex="-1"></a><span class="st">gl = ax.gridlines(</span></span>
<span id="cb27-261"><a href="#cb27-261" aria-hidden="true" tabindex="-1"></a><span class="st">    draw_labels=True, linewidth=1, color="gray", alpha=0.5, linestyle=":", zorder=0</span></span>
<span id="cb27-262"><a href="#cb27-262" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb27-263"><a href="#cb27-263" aria-hidden="true" tabindex="-1"></a><span class="st"># Limits set by eye</span></span>
<span id="cb27-264"><a href="#cb27-264" aria-hidden="true" tabindex="-1"></a><span class="st">ax.set_xlim(2400000, 7400000)</span></span>
<span id="cb27-265"><a href="#cb27-265" aria-hidden="true" tabindex="-1"></a><span class="st">ax.set_ylim(1500000, 3500000)</span></span>
<span id="cb27-266"><a href="#cb27-266" aria-hidden="true" tabindex="-1"></a><span class="st"># Create empty ticks so we can label the axes</span></span>
<span id="cb27-267"><a href="#cb27-267" aria-hidden="true" tabindex="-1"></a><span class="st">ax.set_xticks([])</span></span>
<span id="cb27-268"><a href="#cb27-268" aria-hidden="true" tabindex="-1"></a><span class="st">ax.set_yticks([])</span></span>
<span id="cb27-269"><a href="#cb27-269" aria-hidden="true" tabindex="-1"></a><span class="st">ax.set_xlabel("Longitude", labelpad=15, fontsize=18)</span></span>
<span id="cb27-270"><a href="#cb27-270" aria-hidden="true" tabindex="-1"></a><span class="st">ax.set_ylabel("Latitude", labelpad=35, fontsize=18)</span></span>
<span id="cb27-271"><a href="#cb27-271" aria-hidden="true" tabindex="-1"></a><span class="st">plt.title("Wine-making regions of Europe", fontsize=30, fontweight="light", pad=20)</span></span>
<span id="cb27-272"><a href="#cb27-272" aria-hidden="true" tabindex="-1"></a><span class="st">plt.tight_layout()</span></span>
<span id="cb27-273"><a href="#cb27-273" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb27-274"><a href="#cb27-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-275"><a href="#cb27-275" aria-hidden="true" tabindex="-1"></a><span class="st">This looks very similar to Fig.2 in [@Droulia2022], although they appear to have used a different (and unspecified) projection. </span></span>
<span id="cb27-276"><a href="#cb27-276" aria-hidden="true" tabindex="-1"></a><span class="st">We see that indeed the majority of the vineyards are situated in southern Europe, and virtually none exist above the latitude of $50 ^{\circ}N$. As we expect: grapes for wine like hot, sunny weather.</span></span>
<span id="cb27-277"><a href="#cb27-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-278"><a href="#cb27-278" aria-hidden="true" tabindex="-1"></a><span class="st">Let'</span>s now look more quantitatively at which countries have the largest amount of vineyards. To do so, we use the data from <span class="pp">[</span><span class="ss">Eurostat</span><span class="pp">]</span><span class="er">(</span><span class="ex">https://ec.europa.eu/eurostat</span><span class="kw">)</span><span class="bu">.</span> This is a great resource for all statistical data within the EU.</span>
<span id="cb27-279"><a href="#cb27-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-280"><a href="#cb27-280" aria-hidden="true" tabindex="-1"></a><span class="ex">For</span> this purpose, we will use Eurostat<span class="st">'s [VIT_T1](https://ec.europa.eu/eurostat/web/products-datasets/-/vit_t1) dataset that lists the land usage by different wine types for every EU member state, as well as the [EF_LUS_MAIN](https://ec.europa.eu/eurostat/web/products-datasets/-/ef_lus_main) dataset that gives a more general overview of all agricultural/farm land area use.  For instructions on how to obtain this data, see @sec-eurostat.</span></span>
<span id="cb27-281"><a href="#cb27-281" aria-hidden="true" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb27-282"><a href="#cb27-282" aria-hidden="true" tabindex="-1"></a><span class="st">The detailed code that loads the data, selects the appropriate subsets of both datasets, and merges it into something which is easier to plot below, albeit it'</span>s pretty long. </span>
<span id="cb27-283"><a href="#cb27-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-286"><a href="#cb27-286" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-287"><a href="#cb27-287" aria-hidden="true" tabindex="-1"></a><span class="st">#| code-fold: true</span></span>
<span id="cb27-288"><a href="#cb27-288" aria-hidden="true" tabindex="-1"></a><span class="st">#| code-summary: "</span>Show the code<span class="st">"</span></span>
<span id="cb27-289"><a href="#cb27-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-290"><a href="#cb27-290" aria-hidden="true" tabindex="-1"></a><span class="st"># Setup dataframe to associate 2 letter country codes with country names</span></span>
<span id="cb27-291"><a href="#cb27-291" aria-hidden="true" tabindex="-1"></a><span class="st"># Can be found here: https://www.google.com/url?sa=t&amp;source=web&amp;cd=&amp;ved=2ahUKEwiovcD2kr-BAxVMgv0HHRubDdsQFnoECBQQAQ&amp;url=https%3A%2F%2Fec.europa.eu%2Feurostat%2Fstatistics-explained%2Fimages%2F9%2F9f%2FCountry_Codes_and_Names.xlsx&amp;usg=AOvVaw3E1WY8Fd33SHLq3c0FM01U&amp;opi=89978449</span></span>
<span id="cb27-292"><a href="#cb27-292" aria-hidden="true" tabindex="-1"></a><span class="st">eu_countries = pd.read_excel(f"</span>{DATADIR}/misc/Country_Codes_and_Names.xlsx<span class="st">")</span></span>
<span id="cb27-293"><a href="#cb27-293" aria-hidden="true" tabindex="-1"></a><span class="st">eu_countries["</span>CODE<span class="st">"] = [x.strip() for x in eu_countries["</span>CODE<span class="st">"].values]</span></span>
<span id="cb27-294"><a href="#cb27-294" aria-hidden="true" tabindex="-1"></a><span class="st">eu_countries.loc[eu_countries["</span>CODE<span class="st">"] == "</span>DE<span class="st">", "</span>COUNTRY NAME<span class="st">"] = "</span>Germany<span class="st">"</span></span>
<span id="cb27-295"><a href="#cb27-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-296"><a href="#cb27-296" aria-hidden="true" tabindex="-1"></a><span class="st"># Vineyard area</span></span>
<span id="cb27-297"><a href="#cb27-297" aria-hidden="true" tabindex="-1"></a><span class="st">df_area = pd.read_json(f"</span>{DATADIR}/wine_statistics/VIT_T1.json<span class="st">")</span></span>
<span id="cb27-298"><a href="#cb27-298" aria-hidden="true" tabindex="-1"></a><span class="st"># Pick only data from 2020 for EU countries</span></span>
<span id="cb27-299"><a href="#cb27-299" aria-hidden="true" tabindex="-1"></a><span class="st">df_area = df_area[</span></span>
<span id="cb27-300"><a href="#cb27-300" aria-hidden="true" tabindex="-1"></a><span class="st">    (df_area["</span>geo<span class="st">"].isin(eu_countries["</span>CODE<span class="st">"])) &amp; (df_area["</span>TIME_PERIOD<span class="st">"] == 2020)</span></span>
<span id="cb27-301"><a href="#cb27-301" aria-hidden="true" tabindex="-1"></a><span class="st">]</span></span>
<span id="cb27-302"><a href="#cb27-302" aria-hidden="true" tabindex="-1"></a><span class="st"># Pick only the data for all vineyard types and select the columns we care about</span></span>
<span id="cb27-303"><a href="#cb27-303" aria-hidden="true" tabindex="-1"></a><span class="st">df_area_2020 = df_area[df_area["</span>vinetype<span class="st">"] == "</span>TOTAL<span class="st">"][["</span>geo<span class="st">", "</span>value<span class="st">"]]</span></span>
<span id="cb27-304"><a href="#cb27-304" aria-hidden="true" tabindex="-1"></a><span class="st"># Associate the 2 character ISO country codes with country names</span></span>
<span id="cb27-305"><a href="#cb27-305" aria-hidden="true" tabindex="-1"></a><span class="st">df_area_2020 = df_area_2020.rename(columns={"</span>geo<span class="st">": "</span>CODE<span class="st">"})</span></span>
<span id="cb27-306"><a href="#cb27-306" aria-hidden="true" tabindex="-1"></a><span class="st">df_area_2020 = pd.merge(df_area_2020, eu_countries, how="</span>inner<span class="st">")</span></span>
<span id="cb27-307"><a href="#cb27-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-308"><a href="#cb27-308" aria-hidden="true" tabindex="-1"></a><span class="st"># Permanent crops area</span></span>
<span id="cb27-309"><a href="#cb27-309" aria-hidden="true" tabindex="-1"></a><span class="st">df_area_gen = pd.read_json(f"</span>{DATADIR}/wine_statistics/EF_LUS_MAIN.json<span class="st">")</span></span>
<span id="cb27-310"><a href="#cb27-310" aria-hidden="true" tabindex="-1"></a><span class="st">df_area_gen = df_area_gen[</span></span>
<span id="cb27-311"><a href="#cb27-311" aria-hidden="true" tabindex="-1"></a><span class="st">    (df_area_gen["</span>geo<span class="st">"].isin(eu_countries["</span>CODE<span class="st">"]))</span></span>
<span id="cb27-312"><a href="#cb27-312" aria-hidden="true" tabindex="-1"></a><span class="st">    &amp; (df_area_gen["</span>TIME_PERIOD<span class="st">"] == 2020)</span></span>
<span id="cb27-313"><a href="#cb27-313" aria-hidden="true" tabindex="-1"></a><span class="st">]</span></span>
<span id="cb27-314"><a href="#cb27-314" aria-hidden="true" tabindex="-1"></a><span class="st"># Select permanent crops among all farm types</span></span>
<span id="cb27-315"><a href="#cb27-315" aria-hidden="true" tabindex="-1"></a><span class="st">df_area_gen_2020 = df_area_gen[</span></span>
<span id="cb27-316"><a href="#cb27-316" aria-hidden="true" tabindex="-1"></a><span class="st">    (df_area_gen["</span>crops<span class="st">"] == "</span>PECR<span class="st">") &amp; (df_area_gen["</span>farmtype<span class="st">"] == "</span>TOTAL<span class="st">")</span></span>
<span id="cb27-317"><a href="#cb27-317" aria-hidden="true" tabindex="-1"></a><span class="st">][["</span>geo<span class="st">", "</span>value<span class="st">"]]</span></span>
<span id="cb27-318"><a href="#cb27-318" aria-hidden="true" tabindex="-1"></a><span class="st">df_area_gen_2020 = df_area_gen_2020.rename(columns={"</span>geo<span class="st">": "</span>CODE<span class="st">"})</span></span>
<span id="cb27-319"><a href="#cb27-319" aria-hidden="true" tabindex="-1"></a><span class="st">df_area_gen_2020 = pd.merge(df_area_gen_2020, eu_countries, how="</span>inner<span class="st">")</span></span>
<span id="cb27-320"><a href="#cb27-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-321"><a href="#cb27-321" aria-hidden="true" tabindex="-1"></a><span class="st"># Find all countries that produce more than the given threshold than group the rest into "</span>Others<span class="st">"</span></span>
<span id="cb27-322"><a href="#cb27-322" aria-hidden="true" tabindex="-1"></a><span class="st">total_area = df_area_2020["</span>value<span class="st">"].sum()</span></span>
<span id="cb27-323"><a href="#cb27-323" aria-hidden="true" tabindex="-1"></a><span class="st">th_area = 0.05 * total_area</span></span>
<span id="cb27-324"><a href="#cb27-324" aria-hidden="true" tabindex="-1"></a><span class="st">df_to_plot = df_area_2020[df_area_2020["</span>value<span class="st">"] &gt;= th_area]</span></span>
<span id="cb27-325"><a href="#cb27-325" aria-hidden="true" tabindex="-1"></a><span class="st">row = pd.DataFrame(</span></span>
<span id="cb27-326"><a href="#cb27-326" aria-hidden="true" tabindex="-1"></a><span class="st">    {</span></span>
<span id="cb27-327"><a href="#cb27-327" aria-hidden="true" tabindex="-1"></a><span class="st">        "</span>CODE<span class="st">": "</span>Others<span class="st">",</span></span>
<span id="cb27-328"><a href="#cb27-328" aria-hidden="true" tabindex="-1"></a><span class="st">        "</span>value<span class="st">": df_area_2020[df_area_2020["</span>value<span class="st">"] &lt; th_area]["</span>value<span class="st">"].sum(),</span></span>
<span id="cb27-329"><a href="#cb27-329" aria-hidden="true" tabindex="-1"></a><span class="st">        "</span>COUNTRY NAME<span class="st">": "</span>Others<span class="st">",</span></span>
<span id="cb27-330"><a href="#cb27-330" aria-hidden="true" tabindex="-1"></a><span class="st">    },</span></span>
<span id="cb27-331"><a href="#cb27-331" aria-hidden="true" tabindex="-1"></a><span class="st">    index=[0],</span></span>
<span id="cb27-332"><a href="#cb27-332" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb27-333"><a href="#cb27-333" aria-hidden="true" tabindex="-1"></a><span class="st">df_to_plot = pd.concat([df_to_plot, row], ignore_index=True)</span></span>
<span id="cb27-334"><a href="#cb27-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-335"><a href="#cb27-335" aria-hidden="true" tabindex="-1"></a><span class="st"># Find the total permanent crop area for the same countries that have largest vineyards,</span></span>
<span id="cb27-336"><a href="#cb27-336" aria-hidden="true" tabindex="-1"></a><span class="st"># and group the rest under "</span>Others<span class="st">"</span></span>
<span id="cb27-337"><a href="#cb27-337" aria-hidden="true" tabindex="-1"></a><span class="st">df_to_plot_gen = df_area_gen_2020[df_area_gen_2020["</span>CODE<span class="st">"].isin(df_to_plot["</span>CODE<span class="st">"])]</span></span>
<span id="cb27-338"><a href="#cb27-338" aria-hidden="true" tabindex="-1"></a><span class="st">row = pd.DataFrame(</span></span>
<span id="cb27-339"><a href="#cb27-339" aria-hidden="true" tabindex="-1"></a><span class="st">    {</span></span>
<span id="cb27-340"><a href="#cb27-340" aria-hidden="true" tabindex="-1"></a><span class="st">        "</span>CODE<span class="st">": "</span>Others<span class="st">",</span></span>
<span id="cb27-341"><a href="#cb27-341" aria-hidden="true" tabindex="-1"></a><span class="st">        "</span>value<span class="st">": df_area_gen_2020[~df_area_gen_2020["</span>CODE<span class="st">"].isin(df_to_plot["</span>CODE<span class="st">"])][</span></span>
<span id="cb27-342"><a href="#cb27-342" aria-hidden="true" tabindex="-1"></a><span class="st">            "</span>value<span class="st">"</span></span>
<span id="cb27-343"><a href="#cb27-343" aria-hidden="true" tabindex="-1"></a><span class="st">        ].sum(),</span></span>
<span id="cb27-344"><a href="#cb27-344" aria-hidden="true" tabindex="-1"></a><span class="st">        "</span>COUNTRY NAME<span class="st">": "</span>Others<span class="st">",</span></span>
<span id="cb27-345"><a href="#cb27-345" aria-hidden="true" tabindex="-1"></a><span class="st">    },</span></span>
<span id="cb27-346"><a href="#cb27-346" aria-hidden="true" tabindex="-1"></a><span class="st">    index=[0],</span></span>
<span id="cb27-347"><a href="#cb27-347" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb27-348"><a href="#cb27-348" aria-hidden="true" tabindex="-1"></a><span class="st">df_to_plot_gen = pd.concat([df_to_plot_gen, row], ignore_index=True)</span></span>
<span id="cb27-349"><a href="#cb27-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-350"><a href="#cb27-350" aria-hidden="true" tabindex="-1"></a><span class="st"># Merge everything into 1 dataframe</span></span>
<span id="cb27-351"><a href="#cb27-351" aria-hidden="true" tabindex="-1"></a><span class="st">df_to_plot_gen = df_to_plot_gen.rename(columns={"</span>value<span class="st">": "</span>total_area<span class="st">"})</span></span>
<span id="cb27-352"><a href="#cb27-352" aria-hidden="true" tabindex="-1"></a><span class="st">df_to_plot = pd.merge(df_to_plot, df_to_plot_gen, how="</span>inner<span class="st">")</span></span>
<span id="cb27-353"><a href="#cb27-353" aria-hidden="true" tabindex="-1"></a><span class="st">df_to_plot = df_to_plot.sort_values("</span>value<span class="st">", ascending=False)</span></span>
<span id="cb27-354"><a href="#cb27-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-355"><a href="#cb27-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-356"><a href="#cb27-356" aria-hidden="true" tabindex="-1"></a><span class="st"># Create labels for the square area graph</span></span>
<span id="cb27-357"><a href="#cb27-357" aria-hidden="true" tabindex="-1"></a><span class="st">labels = []</span></span>
<span id="cb27-358"><a href="#cb27-358" aria-hidden="true" tabindex="-1"></a><span class="st">for i in range(df_to_plot.shape[0]):</span></span>
<span id="cb27-359"><a href="#cb27-359" aria-hidden="true" tabindex="-1"></a><span class="st">    wine_area = df_to_plot.iloc[i]["</span>value<span class="st">"]</span></span>
<span id="cb27-360"><a href="#cb27-360" aria-hidden="true" tabindex="-1"></a><span class="st">    gen_area = df_to_plot.iloc[i]["</span>total_area<span class="st">"]</span></span>
<span id="cb27-361"><a href="#cb27-361" aria-hidden="true" tabindex="-1"></a><span class="st">    country = df_to_plot.iloc[i]["</span>COUNTRY NAME<span class="st">"]</span></span>
<span id="cb27-362"><a href="#cb27-362" aria-hidden="true" tabindex="-1"></a><span class="st">    wine_in_kha = int(np.round(wine_area / 1000, 0))</span></span>
<span id="cb27-363"><a href="#cb27-363" aria-hidden="true" tabindex="-1"></a><span class="st">    percent_usage = np.round(wine_area / gen_area * 100, 1)</span></span>
<span id="cb27-364"><a href="#cb27-364" aria-hidden="true" tabindex="-1"></a><span class="st">    label = f"</span>{country}<span class="dt">\n</span>{wine_in_kha} kha<span class="dt">\n</span> <span class="er">(</span><span class="ex">{percent_usage}%</span><span class="kw">)</span><span class="st">"</span></span>
<span id="cb27-365"><a href="#cb27-365" aria-hidden="true" tabindex="-1"></a><span class="st">    labels.append(label)</span></span>
<span id="cb27-366"><a href="#cb27-366" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb27-367"><a href="#cb27-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-368"><a href="#cb27-368" aria-hidden="true" tabindex="-1"></a><span class="ex">Armed</span> with the right data, we can finally visualize the land usage statistics. We will use the <span class="kw">`</span><span class="st">matplotlib</span><span class="kw">`</span> <span class="ex">package</span> along with <span class="pp">[</span><span class="ss">`squarify`</span><span class="pp">]</span><span class="er">(</span><span class="ex">https://github.com/laserson/squarify</span><span class="kw">)</span> <span class="ex">to</span> create two</span>
<span id="cb27-369"><a href="#cb27-369" aria-hidden="true" tabindex="-1"></a><span class="ex">different</span> ways of looking at the data.</span>
<span id="cb27-370"><a href="#cb27-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-373"><a href="#cb27-373" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-374"><a href="#cb27-374" aria-hidden="true" tabindex="-1"></a><span class="st"># | code-fold: true</span></span>
<span id="cb27-375"><a href="#cb27-375" aria-hidden="true" tabindex="-1"></a><span class="st"># | code-summary: "</span><span class="ex">Show</span> the code<span class="st">"</span></span>
<span id="cb27-376"><a href="#cb27-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-377"><a href="#cb27-377" aria-hidden="true" tabindex="-1"></a><span class="st">import squarify</span></span>
<span id="cb27-378"><a href="#cb27-378" aria-hidden="true" tabindex="-1"></a><span class="st">import seaborn as sns</span></span>
<span id="cb27-379"><a href="#cb27-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-380"><a href="#cb27-380" aria-hidden="true" tabindex="-1"></a><span class="st">axis_fontsize = 16</span></span>
<span id="cb27-381"><a href="#cb27-381" aria-hidden="true" tabindex="-1"></a><span class="st">lbl_fontsize = 20</span></span>
<span id="cb27-382"><a href="#cb27-382" aria-hidden="true" tabindex="-1"></a><span class="st">fig = plt.figure(figsize=(13, 6))</span></span>
<span id="cb27-383"><a href="#cb27-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-384"><a href="#cb27-384" aria-hidden="true" tabindex="-1"></a><span class="st"># Left: donut plot</span></span>
<span id="cb27-385"><a href="#cb27-385" aria-hidden="true" tabindex="-1"></a><span class="st">ax = plt.subplot(121)</span></span>
<span id="cb27-386"><a href="#cb27-386" aria-hidden="true" tabindex="-1"></a><span class="st">ax = labelled_pie(</span></span>
<span id="cb27-387"><a href="#cb27-387" aria-hidden="true" tabindex="-1"></a><span class="st">    df_to_plot["</span>value<span class="st">"].values,</span></span>
<span id="cb27-388"><a href="#cb27-388" aria-hidden="true" tabindex="-1"></a><span class="st">    df_to_plot["</span>COUNTRY NAME<span class="st">"].values,</span></span>
<span id="cb27-389"><a href="#cb27-389" aria-hidden="true" tabindex="-1"></a><span class="st">    "</span>Area under vine in the EU for 2020<span class="st">",</span></span>
<span id="cb27-390"><a href="#cb27-390" aria-hidden="true" tabindex="-1"></a><span class="st">    ax=ax,</span></span>
<span id="cb27-391"><a href="#cb27-391" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb27-392"><a href="#cb27-392" aria-hidden="true" tabindex="-1"></a><span class="st">ax.text(</span></span>
<span id="cb27-393"><a href="#cb27-393" aria-hidden="true" tabindex="-1"></a><span class="st">    -0.25,</span></span>
<span id="cb27-394"><a href="#cb27-394" aria-hidden="true" tabindex="-1"></a><span class="st">    -0.15,</span></span>
<span id="cb27-395"><a href="#cb27-395" aria-hidden="true" tabindex="-1"></a><span class="st">    f"</span>Total area<span class="dt">\n{np.round(total_area/1e6</span><span class="op">,</span><span class="dt">1)}</span> mha<span class="st">",</span></span>
<span id="cb27-396"><a href="#cb27-396" aria-hidden="true" tabindex="-1"></a><span class="st">    fontweight="</span>light<span class="st">",</span></span>
<span id="cb27-397"><a href="#cb27-397" aria-hidden="true" tabindex="-1"></a><span class="st">    fontsize=18,</span></span>
<span id="cb27-398"><a href="#cb27-398" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb27-399"><a href="#cb27-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-400"><a href="#cb27-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-401"><a href="#cb27-401" aria-hidden="true" tabindex="-1"></a><span class="st">plt.title("</span>Fraction of total vineyard area<span class="st">", pad=30, fontweight="</span>light<span class="st">", fontsize=22)</span></span>
<span id="cb27-402"><a href="#cb27-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-403"><a href="#cb27-403" aria-hidden="true" tabindex="-1"></a><span class="st"># Right: square area plot</span></span>
<span id="cb27-404"><a href="#cb27-404" aria-hidden="true" tabindex="-1"></a><span class="st">plt.subplot(122)</span></span>
<span id="cb27-405"><a href="#cb27-405" aria-hidden="true" tabindex="-1"></a><span class="st">ax2 = squarify.plot(</span></span>
<span id="cb27-406"><a href="#cb27-406" aria-hidden="true" tabindex="-1"></a><span class="st">    sizes=df_to_plot["</span>value<span class="st">"],</span></span>
<span id="cb27-407"><a href="#cb27-407" aria-hidden="true" tabindex="-1"></a><span class="st">    color=plt.rcParams["</span>axes.prop_cycle<span class="st">"].by_key()["</span>color<span class="st">"],</span></span>
<span id="cb27-408"><a href="#cb27-408" aria-hidden="true" tabindex="-1"></a><span class="st">    label=labels,</span></span>
<span id="cb27-409"><a href="#cb27-409" aria-hidden="true" tabindex="-1"></a><span class="st">    text_kwargs={"</span>fontsize<span class="st">": 16, "</span>color<span class="st">": "</span>white<span class="st">", "</span>fontweight<span class="st">": "</span>normal<span class="st">"},</span></span>
<span id="cb27-410"><a href="#cb27-410" aria-hidden="true" tabindex="-1"></a><span class="st">    edgecolor="</span>white<span class="st">",</span></span>
<span id="cb27-411"><a href="#cb27-411" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb27-412"><a href="#cb27-412" aria-hidden="true" tabindex="-1"></a><span class="st">ax2.tick_params(axis="</span>both<span class="st">", labelsize=axis_fontsize)</span></span>
<span id="cb27-413"><a href="#cb27-413" aria-hidden="true" tabindex="-1"></a><span class="st">ax2.xaxis.label.set_size(lbl_fontsize)</span></span>
<span id="cb27-414"><a href="#cb27-414" aria-hidden="true" tabindex="-1"></a><span class="st">ax2.yaxis.label.set_size(lbl_fontsize)</span></span>
<span id="cb27-415"><a href="#cb27-415" aria-hidden="true" tabindex="-1"></a><span class="st">ax2.xaxis.label.set_fontweight("</span>light<span class="st">")</span></span>
<span id="cb27-416"><a href="#cb27-416" aria-hidden="true" tabindex="-1"></a><span class="st">ax2.yaxis.label.set_fontweight("</span>light<span class="st">")</span></span>
<span id="cb27-417"><a href="#cb27-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-418"><a href="#cb27-418" aria-hidden="true" tabindex="-1"></a><span class="st">ax2.spines[["</span>left<span class="st">", "</span>bottom<span class="st">"]].set_visible(False)</span></span>
<span id="cb27-419"><a href="#cb27-419" aria-hidden="true" tabindex="-1"></a><span class="st">ax2.xaxis.set_visible(False)</span></span>
<span id="cb27-420"><a href="#cb27-420" aria-hidden="true" tabindex="-1"></a><span class="st">ax2.yaxis.set_visible(False)</span></span>
<span id="cb27-421"><a href="#cb27-421" aria-hidden="true" tabindex="-1"></a><span class="st">plt.subplots_adjust(wspace=0.5)</span></span>
<span id="cb27-422"><a href="#cb27-422" aria-hidden="true" tabindex="-1"></a><span class="st">plt.title(</span></span>
<span id="cb27-423"><a href="#cb27-423" aria-hidden="true" tabindex="-1"></a><span class="st">    "</span>Area <span class="er">(</span><span class="ex">fraction</span> of all permanent crops<span class="kw">)</span><span class="st">", pad=20, fontweight="</span><span class="ex">light</span><span class="st">", fontsize=22</span></span>
<span id="cb27-424"><a href="#cb27-424" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb27-425"><a href="#cb27-425" aria-hidden="true" tabindex="-1"></a><span class="st">_ = plt.suptitle(</span></span>
<span id="cb27-426"><a href="#cb27-426" aria-hidden="true" tabindex="-1"></a><span class="st">    f"</span><span class="ex">Area</span> under vine in the EU for 2020<span class="st">", fontsize=30, fontweight="</span>light<span class="st">", y=1.08</span></span>
<span id="cb27-427"><a href="#cb27-427" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb27-428"><a href="#cb27-428" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb27-429"><a href="#cb27-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-430"><a href="#cb27-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-431"><a href="#cb27-431" aria-hidden="true" tabindex="-1"></a><span class="ex">We</span> can clearly see that:</span>
<span id="cb27-432"><a href="#cb27-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-433"><a href="#cb27-433" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> Spain, France and Italy have the largest vineyards, together comprising almost 3/4 of all vineyard area in the EU,</span>
<span id="cb27-434"><a href="#cb27-434" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> For all the top 5 countries, vineyards occupy a sizable fraction of all permanent crop lands, ranging from 20% for Spain to 77% for France.</span>
<span id="cb27-435"><a href="#cb27-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-436"><a href="#cb27-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-437"><a href="#cb27-437" aria-hidden="true" tabindex="-1"></a><span class="co">### Production volume</span></span>
<span id="cb27-438"><a href="#cb27-438" aria-hidden="true" tabindex="-1"></a> <span class="ex">Next,</span> let<span class="st">'s take a look at the volume of wine produced within the EU. After all, just because there is a vineyard doesn'</span>t mean it successfully produced wine. </span>
<span id="cb27-439"><a href="#cb27-439" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb27-440"><a href="#cb27-440" aria-hidden="true" tabindex="-1"></a> <span class="ex">For</span> this, we use a custom dataset which can be obtained from the <span class="st">"Wine Production and opening stocks"</span> <span class="pp">[</span><span class="ss">dashboard</span><span class="pp">]</span><span class="er">(</span><span class="ex">https://agridata.ec.europa.eu/extensions/DashboardWine/WineProduction.html</span><span class="kw">)</span> <span class="ex">of</span> the Directorate-General of Agriculture and Rural Development. See @sec-dgard for details on getting this data.</span>
<span id="cb27-441"><a href="#cb27-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-442"><a href="#cb27-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-443"><a href="#cb27-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-446"><a href="#cb27-446" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-447"><a href="#cb27-447" aria-hidden="true" tabindex="-1"></a><span class="st">df_production = pd.read_excel(f"</span>{DATADIR}/wine_statistics/production_data_dgard.xlsx<span class="st">")</span></span>
<span id="cb27-448"><a href="#cb27-448" aria-hidden="true" tabindex="-1"></a><span class="st">df_production.info()</span></span>
<span id="cb27-449"><a href="#cb27-449" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb27-450"><a href="#cb27-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-451"><a href="#cb27-451" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> relevant columns to use are:</span>
<span id="cb27-452"><a href="#cb27-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-453"><a href="#cb27-453" aria-hidden="true" tabindex="-1"></a> <span class="ex">*</span> <span class="kw">`</span><span class="st">Member State</span><span class="kw">`</span> <span class="ex">-</span> country reporting</span>
<span id="cb27-454"><a href="#cb27-454" aria-hidden="true" tabindex="-1"></a> <span class="ex">*</span> <span class="kw">`</span><span class="st">Category</span><span class="kw">`</span> <span class="ex">and</span> <span class="kw">`</span><span class="st">Product Group</span><span class="kw">`</span> <span class="ex">-</span> type of product being produced</span>
<span id="cb27-455"><a href="#cb27-455" aria-hidden="true" tabindex="-1"></a> <span class="ex">*</span> <span class="kw">`</span><span class="st">Year</span><span class="kw">`</span> <span class="ex">-</span> year reported</span>
<span id="cb27-456"><a href="#cb27-456" aria-hidden="true" tabindex="-1"></a> <span class="ex">*</span> <span class="kw">`</span><span class="st">Production</span><span class="kw">`</span><span class="ex">-</span> the volume of wine produced in thousands of hectorliters <span class="er">(</span><span class="ex">1</span> hl = 100 l<span class="kw">)</span><span class="bu">.</span></span>
<span id="cb27-457"><a href="#cb27-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-458"><a href="#cb27-458" aria-hidden="true" tabindex="-1"></a> <span class="ex">Taking</span> a peek at the type of products being produced, we see:</span>
<span id="cb27-459"><a href="#cb27-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-462"><a href="#cb27-462" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-463"><a href="#cb27-463" aria-hidden="true" tabindex="-1"></a><span class="st">np.unique(df_production[['Category','Product Group']])</span></span>
<span id="cb27-464"><a href="#cb27-464" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb27-465"><a href="#cb27-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-466"><a href="#cb27-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-467"><a href="#cb27-467" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> most salient difference is thus <span class="st">"Non-Vinified"</span> products <span class="er">(</span><span class="ex">i.e.,</span> not wine<span class="kw">)</span> <span class="ex">vs</span> everything else <span class="er">(</span><span class="ex">i.e.,</span> wine<span class="kw">)</span><span class="bu">.</span></span>
<span id="cb27-468"><a href="#cb27-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-469"><a href="#cb27-469" aria-hidden="true" tabindex="-1"></a><span class="ex">Let</span><span class="st">'s narrow things down to only wines, group by country and year, and sum the production over everything else (i.e., `Category` and `Product Group`):</span></span>
<span id="cb27-470"><a href="#cb27-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-473"><a href="#cb27-473" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-474"><a href="#cb27-474" aria-hidden="true" tabindex="-1"></a><span class="st"># Group all wines by country and year</span></span>
<span id="cb27-475"><a href="#cb27-475" aria-hidden="true" tabindex="-1"></a><span class="st">df_tmp = df_production[</span></span>
<span id="cb27-476"><a href="#cb27-476" aria-hidden="true" tabindex="-1"></a><span class="st">    (df_production["Category"] != "Non-Vinified")</span></span>
<span id="cb27-477"><a href="#cb27-477" aria-hidden="true" tabindex="-1"></a><span class="st">    &amp; (df_production["Product Group"] != "Non-Vinified")</span></span>
<span id="cb27-478"><a href="#cb27-478" aria-hidden="true" tabindex="-1"></a><span class="st">].groupby(["Member State", "Year"])</span></span>
<span id="cb27-479"><a href="#cb27-479" aria-hidden="true" tabindex="-1"></a><span class="st">df_tmp.head()</span></span>
<span id="cb27-480"><a href="#cb27-480" aria-hidden="true" tabindex="-1"></a><span class="st"># Now sum over all the wine types. </span></span>
<span id="cb27-481"><a href="#cb27-481" aria-hidden="true" tabindex="-1"></a><span class="st">res = df_tmp["Production"].sum().reset_index() # reset_index turns this from a Series back into a DataFrame</span></span>
<span id="cb27-482"><a href="#cb27-482" aria-hidden="true" tabindex="-1"></a><span class="st">res.head()</span></span>
<span id="cb27-483"><a href="#cb27-483" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb27-484"><a href="#cb27-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-485"><a href="#cb27-485" aria-hidden="true" tabindex="-1"></a><span class="st">Let'</span><span class="ex">s</span> focus on 2022 and see which countries have the largest shares of the overall production.</span>
<span id="cb27-486"><a href="#cb27-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-489"><a href="#cb27-489" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-490"><a href="#cb27-490" aria-hidden="true" tabindex="-1"></a><span class="st">year = 2022</span></span>
<span id="cb27-491"><a href="#cb27-491" aria-hidden="true" tabindex="-1"></a><span class="st">df_year = res[res["</span>Year<span class="st">"] == year]</span></span>
<span id="cb27-492"><a href="#cb27-492" aria-hidden="true" tabindex="-1"></a><span class="st"># For plotting we will group together all countries which produce less than 5%</span></span>
<span id="cb27-493"><a href="#cb27-493" aria-hidden="true" tabindex="-1"></a><span class="st"># of the total</span></span>
<span id="cb27-494"><a href="#cb27-494" aria-hidden="true" tabindex="-1"></a><span class="st">total = df_year["</span>Production<span class="st">"].sum()</span></span>
<span id="cb27-495"><a href="#cb27-495" aria-hidden="true" tabindex="-1"></a><span class="st">th = 0.05 * total</span></span>
<span id="cb27-496"><a href="#cb27-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-497"><a href="#cb27-497" aria-hidden="true" tabindex="-1"></a><span class="st">df_to_plot = df_year[df_year["</span>Production<span class="st">"] &gt;= th]</span></span>
<span id="cb27-498"><a href="#cb27-498" aria-hidden="true" tabindex="-1"></a><span class="st">row = pd.DataFrame(</span></span>
<span id="cb27-499"><a href="#cb27-499" aria-hidden="true" tabindex="-1"></a><span class="st">    {</span></span>
<span id="cb27-500"><a href="#cb27-500" aria-hidden="true" tabindex="-1"></a><span class="st">        "</span>Member State<span class="st">": "</span>Others<span class="st">",</span></span>
<span id="cb27-501"><a href="#cb27-501" aria-hidden="true" tabindex="-1"></a><span class="st">        "</span>Year<span class="st">": year,</span></span>
<span id="cb27-502"><a href="#cb27-502" aria-hidden="true" tabindex="-1"></a><span class="st">        "</span>Production<span class="st">": df_year[df_year["</span>Production<span class="st">"] &lt; th]["</span>Production<span class="st">"].sum(),</span></span>
<span id="cb27-503"><a href="#cb27-503" aria-hidden="true" tabindex="-1"></a><span class="st">    },</span></span>
<span id="cb27-504"><a href="#cb27-504" aria-hidden="true" tabindex="-1"></a><span class="st">    index=[0],</span></span>
<span id="cb27-505"><a href="#cb27-505" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb27-506"><a href="#cb27-506" aria-hidden="true" tabindex="-1"></a><span class="st">df_to_plot = pd.concat([df_to_plot, row], ignore_index=True)</span></span>
<span id="cb27-507"><a href="#cb27-507" aria-hidden="true" tabindex="-1"></a><span class="st"># Sort in descending order by volume  produced</span></span>
<span id="cb27-508"><a href="#cb27-508" aria-hidden="true" tabindex="-1"></a><span class="st">df_to_plot = df_to_plot.sort_values("</span>Production<span class="st">", ascending=False)</span></span>
<span id="cb27-509"><a href="#cb27-509" aria-hidden="true" tabindex="-1"></a><span class="st"># Total production in mega- hectorliters (so 10^8 liters)</span></span>
<span id="cb27-510"><a href="#cb27-510" aria-hidden="true" tabindex="-1"></a><span class="st">total_volume = df_to_plot["</span>Production<span class="st">"].sum()/1000</span></span>
<span id="cb27-511"><a href="#cb27-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-512"><a href="#cb27-512" aria-hidden="true" tabindex="-1"></a><span class="st">df_to_plot.head()</span></span>
<span id="cb27-513"><a href="#cb27-513" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb27-514"><a href="#cb27-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-515"><a href="#cb27-515" aria-hidden="true" tabindex="-1"></a><span class="ex">This</span> data gives the following plot:</span>
<span id="cb27-518"><a href="#cb27-518" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-519"><a href="#cb27-519" aria-hidden="true" tabindex="-1"></a><span class="st"># | code-fold: true</span></span>
<span id="cb27-520"><a href="#cb27-520" aria-hidden="true" tabindex="-1"></a><span class="st"># | code-summary: "</span>Show the code<span class="st">"</span></span>
<span id="cb27-521"><a href="#cb27-521" aria-hidden="true" tabindex="-1"></a><span class="st">fig, ax = plt.subplots(figsize=(10, 6), subplot_kw=dict(aspect="</span>equal<span class="st">"))</span></span>
<span id="cb27-522"><a href="#cb27-522" aria-hidden="true" tabindex="-1"></a><span class="st">ax = labelled_pie(</span></span>
<span id="cb27-523"><a href="#cb27-523" aria-hidden="true" tabindex="-1"></a><span class="st">    df_to_plot["</span>Production<span class="st">"].values,</span></span>
<span id="cb27-524"><a href="#cb27-524" aria-hidden="true" tabindex="-1"></a><span class="st">    df_to_plot["</span>Member State<span class="st">"].values,</span></span>
<span id="cb27-525"><a href="#cb27-525" aria-hidden="true" tabindex="-1"></a><span class="st">    f"</span>EU wine production by volume in {year}<span class="st">",</span></span>
<span id="cb27-526"><a href="#cb27-526" aria-hidden="true" tabindex="-1"></a><span class="st">    ax=ax,</span></span>
<span id="cb27-527"><a href="#cb27-527" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb27-528"><a href="#cb27-528" aria-hidden="true" tabindex="-1"></a><span class="st">_ = plt.text(</span></span>
<span id="cb27-529"><a href="#cb27-529" aria-hidden="true" tabindex="-1"></a><span class="st">    -0.35,</span></span>
<span id="cb27-530"><a href="#cb27-530" aria-hidden="true" tabindex="-1"></a><span class="st">    -0.15,</span></span>
<span id="cb27-531"><a href="#cb27-531" aria-hidden="true" tabindex="-1"></a><span class="st">    f"</span>Total volume<span class="dt">\n{int(np.round(total_volume</span><span class="op">,</span><span class="dt">0))}</span> mhl<span class="st">",</span></span>
<span id="cb27-532"><a href="#cb27-532" aria-hidden="true" tabindex="-1"></a><span class="st">    fontweight="</span>light<span class="st">",</span></span>
<span id="cb27-533"><a href="#cb27-533" aria-hidden="true" tabindex="-1"></a><span class="st">    fontsize=16,</span></span>
<span id="cb27-534"><a href="#cb27-534" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb27-535"><a href="#cb27-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-536"><a href="#cb27-536" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb27-537"><a href="#cb27-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-538"><a href="#cb27-538" aria-hidden="true" tabindex="-1"></a><span class="ex">Unsurprisingly</span> we see that the three countries that domainated by area of vineyards also dominate the production: Italy, France and Spain. </span>
<span id="cb27-539"><a href="#cb27-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-540"><a href="#cb27-540" aria-hidden="true" tabindex="-1"></a><span class="ex">To</span> put the total volume produced into context, it is</span>
<span id="cb27-541"><a href="#cb27-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-542"><a href="#cb27-542" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> about 60% of the total world wine production<span class="pp">[</span><span class="ss">@oiv2022</span><span class="pp">]</span></span>
<span id="cb27-543"><a href="#cb27-543" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> approximately 33 L of wine for every person in the EU<span class="pp">[^</span><span class="ss">1</span><span class="pp">]</span></span>
<span id="cb27-544"><a href="#cb27-544" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> enough to fill about 6900 Olympic swimming pools<span class="pp">[^</span><span class="ss">2</span><span class="pp">]</span></span>
<span id="cb27-545"><a href="#cb27-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-546"><a href="#cb27-546" aria-hidden="true" tabindex="-1"></a><span class="ex">Let</span><span class="st">'s now look at the historical trends, focusing on the top three wine producers. In order to make our findings more robust, we also include data from two additional sources:</span></span>
<span id="cb27-547"><a href="#cb27-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-548"><a href="#cb27-548" aria-hidden="true" tabindex="-1"></a><span class="st">* The [database](https://www.oiv.int/what-we-do/data-discovery-report?oiv) of the International Organisation of Vine and Wine (OIV). See @sec-oiv for more details.</span></span>
<span id="cb27-549"><a href="#cb27-549" aria-hidden="true" tabindex="-1"></a><span class="st">* The [database](https://economics.adelaide.edu.au/wine-economics/databases#annual-database-of-global-wine-markets-1835-to-2019) [@WERI] from Wine Economics Reasearch Institute at University of Adelaide.  This database is a single `Excel` file with over 100 sheets and contains a wealth of historical information.  See @sec-weri for more details.</span></span>
<span id="cb27-550"><a href="#cb27-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-551"><a href="#cb27-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-552"><a href="#cb27-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-555"><a href="#cb27-555" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-556"><a href="#cb27-556" aria-hidden="true" tabindex="-1"></a><span class="st"># | code-fold: true</span></span>
<span id="cb27-557"><a href="#cb27-557" aria-hidden="true" tabindex="-1"></a><span class="st"># | code-summary: "Show the code"</span></span>
<span id="cb27-558"><a href="#cb27-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-559"><a href="#cb27-559" aria-hidden="true" tabindex="-1"></a><span class="st"># Extract the top 3 producers</span></span>
<span id="cb27-560"><a href="#cb27-560" aria-hidden="true" tabindex="-1"></a><span class="st">dominant_producers = df_to_plot["Member State"].values[:3]</span></span>
<span id="cb27-561"><a href="#cb27-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-562"><a href="#cb27-562" aria-hidden="true" tabindex="-1"></a><span class="st"># Load the data from the Wine Economics Research Institute</span></span>
<span id="cb27-563"><a href="#cb27-563" aria-hidden="true" tabindex="-1"></a><span class="st">df_WERI = pd.ExcelFile(</span></span>
<span id="cb27-564"><a href="#cb27-564" aria-hidden="true" tabindex="-1"></a><span class="st">    f"{DATADIR}/wine_statistics/Megafile_of_global_wine_data_1835_to_2016_1217.xlsx"</span></span>
<span id="cb27-565"><a href="#cb27-565" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb27-566"><a href="#cb27-566" aria-hidden="true" tabindex="-1"></a><span class="st"># Select the right sheet</span></span>
<span id="cb27-567"><a href="#cb27-567" aria-hidden="true" tabindex="-1"></a><span class="st">df_production_WERI = df_WERI.parse("T6 Wine production", header=1)</span></span>
<span id="cb27-568"><a href="#cb27-568" aria-hidden="true" tabindex="-1"></a><span class="st"># Rename the no-name column with year</span></span>
<span id="cb27-569"><a href="#cb27-569" aria-hidden="true" tabindex="-1"></a><span class="st">df_production_WERI = df_production_WERI.rename(columns={"Unnamed: 0": "Year"})</span></span>
<span id="cb27-570"><a href="#cb27-570" aria-hidden="true" tabindex="-1"></a><span class="st">df_tcmp = df_production_WERI[df_production_WERI["Year"].isin(res["Year"].values)]</span></span>
<span id="cb27-571"><a href="#cb27-571" aria-hidden="true" tabindex="-1"></a><span class="st"># Load data from the OIV</span></span>
<span id="cb27-572"><a href="#cb27-572" aria-hidden="true" tabindex="-1"></a><span class="st">df_oiv = pd.read_excel(f"{DATADIR}/wine_statistics/oiv_data.xlsx")</span></span>
<span id="cb27-573"><a href="#cb27-573" aria-hidden="true" tabindex="-1"></a><span class="st"># We need to select the appropriate units of volume. Note the strange /xa0 character which shows</span></span>
<span id="cb27-574"><a href="#cb27-574" aria-hidden="true" tabindex="-1"></a><span class="st"># up as a space!</span></span>
<span id="cb27-575"><a href="#cb27-575" aria-hidden="true" tabindex="-1"></a><span class="st">df_production_OIV = df_oiv[(df_oiv["Variable"] == "Production") &amp; (df_oiv['</span><span class="ex">Unit</span><span class="st">'] == "1000\xa0hl")]</span></span>
<span id="cb27-576"><a href="#cb27-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-577"><a href="#cb27-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-578"><a href="#cb27-578" aria-hidden="true" tabindex="-1"></a><span class="st"># Setup some defaults</span></span>
<span id="cb27-579"><a href="#cb27-579" aria-hidden="true" tabindex="-1"></a><span class="st">golden = (1 + np.sqrt(5)) / 2</span></span>
<span id="cb27-580"><a href="#cb27-580" aria-hidden="true" tabindex="-1"></a><span class="st">width = 10</span></span>
<span id="cb27-581"><a href="#cb27-581" aria-hidden="true" tabindex="-1"></a><span class="st">height = width / golden</span></span>
<span id="cb27-582"><a href="#cb27-582" aria-hidden="true" tabindex="-1"></a><span class="st">ax = setup_timeseries_plot(width=width, height=height)</span></span>
<span id="cb27-583"><a href="#cb27-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-584"><a href="#cb27-584" aria-hidden="true" tabindex="-1"></a><span class="st"># Note the changes in the quantities being plotted: everything is converted to</span></span>
<span id="cb27-585"><a href="#cb27-585" aria-hidden="true" tabindex="-1"></a><span class="st"># mega hectorliters (mha, 1e8 litres)</span></span>
<span id="cb27-586"><a href="#cb27-586" aria-hidden="true" tabindex="-1"></a><span class="st">for country in dominant_producers:</span></span>
<span id="cb27-587"><a href="#cb27-587" aria-hidden="true" tabindex="-1"></a><span class="st">    tmp = res[res["Member State"] == country]</span></span>
<span id="cb27-588"><a href="#cb27-588" aria-hidden="true" tabindex="-1"></a><span class="st">    (line,) = ax.plot(tmp["Year"], tmp["Production"] / 1000, label=country)</span></span>
<span id="cb27-589"><a href="#cb27-589" aria-hidden="true" tabindex="-1"></a><span class="st">    tmp_oiv = df_production_OIV[df_production_OIV["Region/Country"] == country]</span></span>
<span id="cb27-590"><a href="#cb27-590" aria-hidden="true" tabindex="-1"></a><span class="st">    ax.plot(tmp_oiv["Year"], tmp_oiv["Quantity"] / 1e3, ls=":", color=line.get_color())</span></span>
<span id="cb27-591"><a href="#cb27-591" aria-hidden="true" tabindex="-1"></a><span class="st">    ax.plot(</span></span>
<span id="cb27-592"><a href="#cb27-592" aria-hidden="true" tabindex="-1"></a><span class="st">        df_tcmp["Year"], df_tcmp[country] * 10 / 1e6, ls="--", color=line.get_color()</span></span>
<span id="cb27-593"><a href="#cb27-593" aria-hidden="true" tabindex="-1"></a><span class="st">    )</span></span>
<span id="cb27-594"><a href="#cb27-594" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb27-595"><a href="#cb27-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-596"><a href="#cb27-596" aria-hidden="true" tabindex="-1"></a><span class="st"># Manually create the legend to distinguish the datasets</span></span>
<span id="cb27-597"><a href="#cb27-597" aria-hidden="true" tabindex="-1"></a><span class="st">from matplotlib.lines import Line2D</span></span>
<span id="cb27-598"><a href="#cb27-598" aria-hidden="true" tabindex="-1"></a><span class="st">line1 = Line2D([0], [0], label='</span><span class="ex">Eurostat</span><span class="st">', color='</span><span class="ex">k</span><span class="st">')</span></span>
<span id="cb27-599"><a href="#cb27-599" aria-hidden="true" tabindex="-1"></a><span class="st">line2 = Line2D([0], [0], label='</span><span class="ex">OIV</span><span class="st">', color='</span><span class="ex">k</span><span class="st">',ls=":")</span></span>
<span id="cb27-600"><a href="#cb27-600" aria-hidden="true" tabindex="-1"></a><span class="st">line3 = Line2D([0], [0], label='</span><span class="ex">WERI</span><span class="st">', color='</span><span class="ex">k</span><span class="st">',ls="--")</span></span>
<span id="cb27-601"><a href="#cb27-601" aria-hidden="true" tabindex="-1"></a><span class="st">handles, labels = ax.get_legend_handles_labels()</span></span>
<span id="cb27-602"><a href="#cb27-602" aria-hidden="true" tabindex="-1"></a><span class="st">handles.extend([line1,line2,line3])</span></span>
<span id="cb27-603"><a href="#cb27-603" aria-hidden="true" tabindex="-1"></a><span class="st">ax.legend(handles=handles,ncol=2,loc=4, prop={"size": 14, "weight": "light"})</span></span>
<span id="cb27-604"><a href="#cb27-604" aria-hidden="true" tabindex="-1"></a><span class="st">ax.set_xlabel("Year")</span></span>
<span id="cb27-605"><a href="#cb27-605" aria-hidden="true" tabindex="-1"></a><span class="st">ax.set_ylabel("Volume (millions of hectolitres)")</span></span>
<span id="cb27-606"><a href="#cb27-606" aria-hidden="true" tabindex="-1"></a><span class="st">_ = ax.set_title("Top wine producers in the EU", fontsize=30, fontweight="light")</span></span>
<span id="cb27-607"><a href="#cb27-607" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb27-608"><a href="#cb27-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-609"><a href="#cb27-609" aria-hidden="true" tabindex="-1"></a><span class="st">Interestingly the three data sources agree very well for France and Spain but disagree substantially for Italy. If one takes the Eurostat dataset and add back the "Non-Vinified" data, one gets the following:</span></span>
<span id="cb27-610"><a href="#cb27-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-613"><a href="#cb27-613" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-614"><a href="#cb27-614" aria-hidden="true" tabindex="-1"></a><span class="st"># | code-fold: true</span></span>
<span id="cb27-615"><a href="#cb27-615" aria-hidden="true" tabindex="-1"></a><span class="st"># | code-summary: "Show the code"</span></span>
<span id="cb27-616"><a href="#cb27-616" aria-hidden="true" tabindex="-1"></a><span class="st"># |</span></span>
<span id="cb27-617"><a href="#cb27-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-618"><a href="#cb27-618" aria-hidden="true" tabindex="-1"></a><span class="st"># Data where _all_ grape production is included</span></span>
<span id="cb27-619"><a href="#cb27-619" aria-hidden="true" tabindex="-1"></a><span class="st">res2 = df_production.groupby(["Member State", "Year"])["Production"].sum().reset_index()</span></span>
<span id="cb27-620"><a href="#cb27-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-621"><a href="#cb27-621" aria-hidden="true" tabindex="-1"></a><span class="st">ax = setup_timeseries_plot(width=width, height=height)</span></span>
<span id="cb27-622"><a href="#cb27-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-623"><a href="#cb27-623" aria-hidden="true" tabindex="-1"></a><span class="st"># Note the changes in the quantities being plotted: everything is converted to</span></span>
<span id="cb27-624"><a href="#cb27-624" aria-hidden="true" tabindex="-1"></a><span class="st"># mega hectorliters (mha, 1e8 litres)</span></span>
<span id="cb27-625"><a href="#cb27-625" aria-hidden="true" tabindex="-1"></a><span class="st">country = "Italy"</span></span>
<span id="cb27-626"><a href="#cb27-626" aria-hidden="true" tabindex="-1"></a><span class="st">tmp = res[res["Member State"] == country]</span></span>
<span id="cb27-627"><a href="#cb27-627" aria-hidden="true" tabindex="-1"></a><span class="st">tmp2 = res2[res2["Member State"] == country]</span></span>
<span id="cb27-628"><a href="#cb27-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-629"><a href="#cb27-629" aria-hidden="true" tabindex="-1"></a><span class="st">(line,) = ax.plot(tmp["Year"], tmp["Production"] / 1000, label="Eurostat")</span></span>
<span id="cb27-630"><a href="#cb27-630" aria-hidden="true" tabindex="-1"></a><span class="st">ax.plot(tmp2["Year"], tmp2["Production"] / 1000, label="Eurostat, all", ls="-")</span></span>
<span id="cb27-631"><a href="#cb27-631" aria-hidden="true" tabindex="-1"></a><span class="st">tmp_oiv = df_production_OIV[df_production_OIV["Region/Country"] == country]</span></span>
<span id="cb27-632"><a href="#cb27-632" aria-hidden="true" tabindex="-1"></a><span class="st">ax.plot(tmp_oiv["Year"], tmp_oiv["Quantity"] / 1e3, ls="--", label="OIV")</span></span>
<span id="cb27-633"><a href="#cb27-633" aria-hidden="true" tabindex="-1"></a><span class="st">ax.plot(df_tcmp["Year"], df_tcmp[country] * 10 / 1e6, ls=":", label="WERI")</span></span>
<span id="cb27-634"><a href="#cb27-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-635"><a href="#cb27-635" aria-hidden="true" tabindex="-1"></a><span class="st">ax.legend(loc=3, prop={"size": 14, "weight": "light"})</span></span>
<span id="cb27-636"><a href="#cb27-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-637"><a href="#cb27-637" aria-hidden="true" tabindex="-1"></a><span class="st">ax.set_xlabel("Year")</span></span>
<span id="cb27-638"><a href="#cb27-638" aria-hidden="true" tabindex="-1"></a><span class="st">ax.set_ylabel("Volume (millions of hectolitres)")</span></span>
<span id="cb27-639"><a href="#cb27-639" aria-hidden="true" tabindex="-1"></a><span class="st">_ = ax.set_title("Italy wine production", fontsize=30, fontweight="light")</span></span>
<span id="cb27-640"><a href="#cb27-640" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb27-641"><a href="#cb27-641" aria-hidden="true" tabindex="-1"></a><span class="st">Thus it appears that there is some sort of inconsistency in the reporting of the production volume, which affects Italy in particular.</span></span>
<span id="cb27-642"><a href="#cb27-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-643"><a href="#cb27-643" aria-hidden="true" tabindex="-1"></a><span class="st">The WERI data set actually extends much further into the past for some countries, so it'</span><span class="ex">s</span> interesting to see even more long-term trends:</span>
<span id="cb27-644"><a href="#cb27-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-647"><a href="#cb27-647" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-648"><a href="#cb27-648" aria-hidden="true" tabindex="-1"></a><span class="st"># | code-fold: true</span></span>
<span id="cb27-649"><a href="#cb27-649" aria-hidden="true" tabindex="-1"></a><span class="st"># | code-summary: "</span>Show the code<span class="st">"</span></span>
<span id="cb27-650"><a href="#cb27-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-651"><a href="#cb27-651" aria-hidden="true" tabindex="-1"></a><span class="st">ax = setup_timeseries_plot(width=width,height=height)</span></span>
<span id="cb27-652"><a href="#cb27-652" aria-hidden="true" tabindex="-1"></a><span class="st">for country in dominant_producers:</span></span>
<span id="cb27-653"><a href="#cb27-653" aria-hidden="true" tabindex="-1"></a><span class="st">    ax.plot(</span></span>
<span id="cb27-654"><a href="#cb27-654" aria-hidden="true" tabindex="-1"></a><span class="st">        df_production_WERI["</span>Year<span class="st">"], df_production_WERI[country] * 10 / 1e6, ls="</span>-<span class="st">",label=country</span></span>
<span id="cb27-655"><a href="#cb27-655" aria-hidden="true" tabindex="-1"></a><span class="st">    )</span></span>
<span id="cb27-656"><a href="#cb27-656" aria-hidden="true" tabindex="-1"></a><span class="st">ax.set_xlabel("</span>Year<span class="st">")</span></span>
<span id="cb27-657"><a href="#cb27-657" aria-hidden="true" tabindex="-1"></a><span class="st">ax.set_ylabel("</span>Volume <span class="er">(</span><span class="ex">millions</span> of hectolitres<span class="kw">)</span><span class="st">")</span></span>
<span id="cb27-658"><a href="#cb27-658" aria-hidden="true" tabindex="-1"></a><span class="st">_ = ax.legend(loc=2, prop={"</span><span class="ex">size</span><span class="st">": 14, "</span><span class="ex">weight</span><span class="st">": "</span><span class="ex">light</span><span class="st">"})</span></span>
<span id="cb27-659"><a href="#cb27-659" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb27-660"><a href="#cb27-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-661"><a href="#cb27-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-662"><a href="#cb27-662" aria-hidden="true" tabindex="-1"></a><span class="ex">A</span> few interesting things to observe:</span>
<span id="cb27-663"><a href="#cb27-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-664"><a href="#cb27-664" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> Historically, Italy and France produced far more wine than Spain</span>
<span id="cb27-665"><a href="#cb27-665" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> The production of wine reached the highest recorded value around 1975 for Italy and France and has been declining ever since, with current levels at about 50% of the peak.</span>
<span id="cb27-666"><a href="#cb27-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-667"><a href="#cb27-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-668"><a href="#cb27-668" aria-hidden="true" tabindex="-1"></a><span class="ex">[^1]:</span> See the demographics data <span class="pp">[</span><span class="ss">here</span><span class="pp">]</span><span class="er">(</span><span class="ex">https://ec.europa.eu/eurostat/databrowser/view/DEMO_GIND__custom_7127262/default/table</span><span class="kw">)</span></span>
<span id="cb27-669"><a href="#cb27-669" aria-hidden="true" tabindex="-1"></a><span class="ex">[^2]:</span> Assuming as standard swimming-pool capacity of <span class="va">$2</span>.5<span class="dt">\t</span>imes 10^{6}$ liters.</span>
<span id="cb27-670"><a href="#cb27-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-671"><a href="#cb27-671" aria-hidden="true" tabindex="-1"></a><span class="co"># Appendix</span></span>
<span id="cb27-672"><a href="#cb27-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-673"><a href="#cb27-673" aria-hidden="true" tabindex="-1"></a><span class="co">## Analysis environment {#sec-env}</span></span>
<span id="cb27-674"><a href="#cb27-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-675"><a href="#cb27-675" aria-hidden="true" tabindex="-1"></a><span class="ex">For</span> the <span class="kw">`</span><span class="st">Python</span><span class="kw">`</span> <span class="ex">setup</span> we use <span class="kw">`</span><span class="st">mambaforge</span><span class="kw">`</span> <span class="fu">as</span> a drop-in replacement for the more widely known <span class="kw">`</span><span class="st">conda</span><span class="kw">`</span><span class="bu">.</span> You can download the latest version from the <span class="pp">[</span><span class="ss">website</span><span class="pp">]</span><span class="er">(</span><span class="ex">https://github.com/conda-forge/miniforge#mambaforge</span><span class="kw">)</span> <span class="ex">or</span> run:</span>
<span id="cb27-676"><a href="#cb27-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-677"><a href="#cb27-677" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span><span class="st">bash</span></span>
<span id="cb27-678"><a href="#cb27-678" aria-hidden="true" tabindex="-1"></a><span class="st">wget https://github.com/conda-forge/miniforge/releases/latest/download/Mambaforge-Linux-x86_64.sh</span></span>
<span id="cb27-679"><a href="#cb27-679" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb27-680"><a href="#cb27-680" aria-hidden="true" tabindex="-1"></a><span class="ex">and</span> then execute the file.</span>
<span id="cb27-681"><a href="#cb27-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-682"><a href="#cb27-682" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> <span class="kw">`</span><span class="st">yaml</span><span class="kw">`</span> <span class="fu">file</span> with all the dependencies can be found <span class="pp">[</span><span class="ss">here</span><span class="pp">]</span><span class="er">(</span><span class="ex">https://github.com/SergeiOssokine/SergeiOssokine.github.io/blob/main/analysis/setup/environment.yml</span><span class="kw">)</span><span class="bu">.</span> To install everything, run the following command <span class="er">(</span><span class="cf">if</span> <span class="ex">you</span> prefer to use <span class="kw">`</span><span class="ex">conda</span><span class="kw">`</span>, you will need to first do <span class="kw">`</span><span class="ex">conda</span> config <span class="at">--add</span> channels conda-forge<span class="kw">`</span> and then replace <span class="kw">`</span><span class="ex">mamba</span><span class="kw">`</span> with <span class="kw">`</span><span class="ex">conda</span><span class="kw">`</span> everywhere below<span class="kw">)</span><span class="bu">:</span></span>
<span id="cb27-683"><a href="#cb27-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-684"><a href="#cb27-684" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span><span class="st">bash</span></span>
<span id="cb27-685"><a href="#cb27-685" aria-hidden="true" tabindex="-1"></a><span class="st">mamba env create -f environment.yml</span></span>
<span id="cb27-686"><a href="#cb27-686" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb27-687"><a href="#cb27-687" aria-hidden="true" tabindex="-1"></a><span class="ex">Then</span> activate the environment with </span>
<span id="cb27-688"><a href="#cb27-688" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span><span class="st">bash</span></span>
<span id="cb27-689"><a href="#cb27-689" aria-hidden="true" tabindex="-1"></a><span class="st">mamba activate wine-analysis</span></span>
<span id="cb27-690"><a href="#cb27-690" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb27-691"><a href="#cb27-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-692"><a href="#cb27-692" aria-hidden="true" tabindex="-1"></a><span class="co">## Datasets </span></span>
<span id="cb27-693"><a href="#cb27-693" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> appendix describes in detail how to obtain the datasets used in this blog. </span>
<span id="cb27-694"><a href="#cb27-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-695"><a href="#cb27-695" aria-hidden="true" tabindex="-1"></a><span class="co">### Corine Land Cover {#sec-corine}</span></span>
<span id="cb27-696"><a href="#cb27-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-697"><a href="#cb27-697" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> Corine Land Cover dataset provides multi-year, land coverage data for Europe, with the latest release being CLC-2018. To obtain the data:</span>
<span id="cb27-698"><a href="#cb27-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-699"><a href="#cb27-699" aria-hidden="true" tabindex="-1"></a><span class="ex">1.</span> Go to the [latest data release]<span class="er">(</span><span class="ex">https://land.copernicus.eu/en/products/corine-land-cover/clc2018</span><span class="kw">)</span><span class="bu">.</span> Click <span class="st">"Download"</span> in the left side-bar.</span>
<span id="cb27-700"><a href="#cb27-700" aria-hidden="true" tabindex="-1"></a><span class="ex">2.</span> Register  for the EU Login if you don<span class="st">'t have one /Log in if you already do</span></span>
<span id="cb27-701"><a href="#cb27-701" aria-hidden="true" tabindex="-1"></a><span class="st">3. Scroll down to "Download pre-packaged data collections" and select "u2018_clc2018_v2020_20u1_raster100m"</span></span>
<span id="cb27-702"><a href="#cb27-702" aria-hidden="true" tabindex="-1"></a><span class="st">4. Click "Add to cart"</span></span>
<span id="cb27-703"><a href="#cb27-703" aria-hidden="true" tabindex="-1"></a><span class="st">5. Go to your cart, select this dataset and click "Start downloading". This will queue your task.</span></span>
<span id="cb27-704"><a href="#cb27-704" aria-hidden="true" tabindex="-1"></a><span class="st">6. Navigate to "Downloads process page". There you will see your task go from "Queued" first to "In progress" and then finally to "Completed" at which point you can click the "Download file" link to actually download your data.</span></span>
<span id="cb27-705"><a href="#cb27-705" aria-hidden="true" tabindex="-1"></a><span class="st">7. Unzip the data and it'</span>s ready for use</span>
<span id="cb27-706"><a href="#cb27-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-707"><a href="#cb27-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-708"><a href="#cb27-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-709"><a href="#cb27-709" aria-hidden="true" tabindex="-1"></a><span class="co">### Eurostat data {#sec-eurostat}</span></span>
<span id="cb27-710"><a href="#cb27-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-711"><a href="#cb27-711" aria-hidden="true" tabindex="-1"></a><span class="ex">By</span> far the easiest way to get the relevant data is through the [web interface]<span class="er">(</span><span class="ex">https://ec.europa.eu/eurostat/databrowser/view/vit_t1/default/table?lang=en</span><span class="kw">)</span><span class="bu">.</span> Alternatively one could either:</span>
<span id="cb27-712"><a href="#cb27-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-713"><a href="#cb27-713" aria-hidden="true" tabindex="-1"></a><span class="ex">a.</span> Download directly with e.g. <span class="kw">`</span><span class="st">curl -o wine_land_usage_area_vit_t1.csv.gz https://ec.europa.eu/eurostat/estat-navtree-portlet-prod/BulkDownloadListing?file=data/vit_t1.tsv.gz</span><span class="kw">`</span></span>
<span id="cb27-714"><a href="#cb27-714" aria-hidden="true" tabindex="-1"></a><span class="ex">b.</span> Use the REST API, see e.g. <span class="pp">[</span><span class="ss">here</span><span class="pp">]</span><span class="er">(</span><span class="ex">https://wikis.ec.europa.eu/display/EurostatHELP/API+Statistics+-+data+query</span><span class="kw">)</span> <span class="cf">for</span> more <span class="ex">information.</span> Note that the parsing of the resulting data can be a bit involved. </span>
<span id="cb27-715"><a href="#cb27-715" aria-hidden="true" tabindex="-1"></a><span class="ex">c.</span> Use a language-specific third-party package for Eurostat data, for example for <span class="pp">[</span><span class="ss">Python</span><span class="pp">]</span><span class="er">(</span><span class="ex">https://pypi.org/project/eurostat/</span><span class="kw">)</span> <span class="ex">or</span> for <span class="pp">[</span><span class="ss">R</span><span class="pp">]</span><span class="er">(</span><span class="ex">https://ropengov.github.io/eurostat/articles/eurostat_tutorial.html</span><span class="kw">)</span></span>
<span id="cb27-716"><a href="#cb27-716" aria-hidden="true" tabindex="-1"></a><span class="ex">d.</span> Use a package for parsing SDMX data, for example <span class="pp">[</span><span class="ss">pandasdmx</span><span class="pp">]</span><span class="er">(</span><span class="ex">https://pandasdmx.readthedocs.io/en/v1.0/</span><span class="kw">)</span><span class="bu">.</span> </span>
<span id="cb27-717"><a href="#cb27-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-718"><a href="#cb27-718" aria-hidden="true" tabindex="-1"></a><span class="ex">We</span> use approach d. in order to ensure easy reproducibility and allow us to retrieve any number of datasets from Eurostat.  The 2 datasets we use in this analysis are</span>
<span id="cb27-719"><a href="#cb27-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-720"><a href="#cb27-720" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> <span class="kw">`</span><span class="st">VIT_T1</span><span class="kw">`</span> <span class="cf">for</span> detailed <span class="ex">overview</span> of vineyard area in the EU</span>
<span id="cb27-721"><a href="#cb27-721" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> <span class="kw">`</span><span class="st">EF_LUS_MAIN</span><span class="kw">`</span> <span class="cf">for</span> overall <span class="ex">land</span> use by the agriculture sector in the EU</span>
<span id="cb27-722"><a href="#cb27-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-723"><a href="#cb27-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-724"><a href="#cb27-724" aria-hidden="true" tabindex="-1"></a><span class="ex">As</span> an example let<span class="st">'s get the data from `VIT_T1`. Conveniently, the `pandasdmx` package already has a client for retriving data from `Eurostat`. For example:</span></span>
<span id="cb27-727"><a href="#cb27-727" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb27-728"><a href="#cb27-728" aria-hidden="true" tabindex="-1"></a><span class="st">import pandasdmx as sdmx</span></span>
<span id="cb27-729"><a href="#cb27-729" aria-hidden="true" tabindex="-1"></a><span class="st">estat = sdmx.Request("ESTAT")</span></span>
<span id="cb27-730"><a href="#cb27-730" aria-hidden="true" tabindex="-1"></a><span class="st">resp = estat.data("VIT_T1",key={'</span>unit<span class="st">':'</span>HA<span class="st">'}) # Only take land area in units of hectares</span></span>
<span id="cb27-731"><a href="#cb27-731" aria-hidden="true" tabindex="-1"></a><span class="st">df = sdmx.to_pandas(resp).reset_index() # reset_index() makes it a flat dataframe</span></span>
<span id="cb27-732"><a href="#cb27-732" aria-hidden="true" tabindex="-1"></a><span class="st">df.head()</span></span>
<span id="cb27-733"><a href="#cb27-733" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb27-734"><a href="#cb27-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-735"><a href="#cb27-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-736"><a href="#cb27-736" aria-hidden="true" tabindex="-1"></a><span class="st">The script to retrieve all the datasets (and associated metadata) and dump it to  convenient `json` files is [here](https://github.com/SergeiOssokine/SergeiOssokine.github.io/blob/main/analysis/scripts/get_data_eurostat_sdmx.py).</span></span>
<span id="cb27-737"><a href="#cb27-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-738"><a href="#cb27-738" aria-hidden="true" tabindex="-1"></a><span class="st">### Wine production data from Directorate-General for Agriculture and Rural Development {#sec-dgard}</span></span>
<span id="cb27-739"><a href="#cb27-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-740"><a href="#cb27-740" aria-hidden="true" tabindex="-1"></a><span class="st">The DGARD maintains a dashboard that pulls together various statistics on wine production in the EU. To get the data:</span></span>
<span id="cb27-741"><a href="#cb27-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-742"><a href="#cb27-742" aria-hidden="true" tabindex="-1"></a><span class="st">1. Navigate to [the dashboard](https://agridata.ec.europa.eu/extensions/DashboardWine/WineProduction.html)</span></span>
<span id="cb27-743"><a href="#cb27-743" aria-hidden="true" tabindex="-1"></a><span class="st">2. Click the "triangle" at the top right corner and select "Data explorer"</span></span>
<span id="cb27-744"><a href="#cb27-744" aria-hidden="true" tabindex="-1"></a><span class="st">3. Click the  "Export data" icon on the right of the header row. This will download the `Excel` file with the data.</span></span>
<span id="cb27-745"><a href="#cb27-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-746"><a href="#cb27-746" aria-hidden="true" tabindex="-1"></a><span class="st">### OIV statistics database {#sec-oiv}</span></span>
<span id="cb27-747"><a href="#cb27-747" aria-hidden="true" tabindex="-1"></a><span class="st">The International Organization of Vine and Wine (OIV) maintains a database of statistical data about many aspects of wine making. One can download the data used in this analysis as follows:</span></span>
<span id="cb27-748"><a href="#cb27-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-749"><a href="#cb27-749" aria-hidden="true" tabindex="-1"></a><span class="st">1. Go to the [database section](https://www.oiv.int/what-we-do/data-discovery-report?oiv) of the OIV website</span></span>
<span id="cb27-750"><a href="#cb27-750" aria-hidden="true" tabindex="-1"></a><span class="st">2. Select "Europe" from the "Continent" drop-down</span></span>
<span id="cb27-751"><a href="#cb27-751" aria-hidden="true" tabindex="-1"></a><span class="st">2. Click on the "..." at the upper right corner of the table ("More options") and select "Export data"</span></span>
<span id="cb27-752"><a href="#cb27-752" aria-hidden="true" tabindex="-1"></a><span class="st">3. Leave the selection on "Data with current layout" and click "Export"</span></span>
<span id="cb27-753"><a href="#cb27-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-754"><a href="#cb27-754" aria-hidden="true" tabindex="-1"></a><span class="st">### WERI wine database {#sec-weri}</span></span>
<span id="cb27-755"><a href="#cb27-755" aria-hidden="true" tabindex="-1"></a><span class="st">The Wine Economics Reasearch Institute at University of Adelaide maintains an extensive database of historical data related to wine. To obtain this data:</span></span>
<span id="cb27-756"><a href="#cb27-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-757"><a href="#cb27-757" aria-hidden="true" tabindex="-1"></a><span class="st">1. Go to [the database website](https://economics.adelaide.edu.au/wine-economics/databases#annual-database-of-global-wine-markets-1835-to-20190)</span></span>
<span id="cb27-758"><a href="#cb27-758" aria-hidden="true" tabindex="-1"></a><span class="st">2. Click "Download megafile of global wine data"</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>